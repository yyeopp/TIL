# MySQL

## RDBMS & SQL

### RDBMS?

- **관계형** 데이터베이스 시스템

- **테이블 기반**의 DMBS.
  
  - 데이터를 테이블 단위로 관리.
    
    - 하나의 테이블은 여러 개의 컬럼으로 구성
  
  - 중복 데이터를 최소화시킴
    
    - 같은 데이터가 여러 컬럼 또는 테이블에 존재할 경우, 데이터 수정 시 문제 발생 가능성이 높아짐. -> **정규화** 필요
  
  - 여러 테이블에 분산되어 있는 데이터를 검색 시 테이블 간의 관계(join)를 이용하여 필요한 데이터를 검색.

### SQL (Structured Query Language)

#### SQL

- DB에 있는 정보를 사용할 수 있도록 지원하는 언어

- 모든 DBMS에서 사용 가능

- 대소문자는 구별하지 않음. (단, 데이터의 대소문자는 구분)

#### SQL 구문

- DCL, DDL, DML로 구분하며, 여러 종류가 있다.

- insert, update, delete, select, create, alter, drop, rename, commit, rollback, grant, revoke 까지

### Data Type

#### 문자형

- CHAR: 고정 길이를 갖는 문자열

- VARCHAR: 가변 길이를 갖는 문자열

- TEXT: 최대 65535 byte

- 그 외 tinytext, mediumtext, longtext, enum(열거형), set(집합형)

#### 숫자형

#### 날짜형

#### 이진 데이터 타입

### table 생성

## DML (Insert, Update, Delete)

### Insert

### Update

### Delete

## DML(Select)

### Diagram

### 기본 Select

### alias, 사칙연산, NULL

### CASE, when, END

### Where

`Select, from, where` 가 주어질 때 실행 순서는?

- from -> where -> select

### And, or, not

### In

### Between

### Null 비교

### Like

### Order by

`Select, from, where, order by`가 주어질 때 실행 순서는?

- from -> where -> select -> order by

- 여러 기준으로 정렬 가능: 순차적으로 이루어짐

## 내장함수

### MySQL 내장함수

- 숫자 관련, 문자 관련, 날짜 관련, 논리 관련, 그룹 함수

## Transaction

- 데이터베이스의 상태를 변화시키는 일종의 작업 단위

- 여러 도구들이 존재
  
  - commit, rollback

## Aggregation

## Group by Clause

### group by 절

- select 문에서 group by 절을 사용할 경우 DB는 쿼리된 테이블의 행을 **그룹으로 묶는다.**

- DB는 선택 목록의 집계 함수를 각 행 그룹에 적용하고 각 그룹에 대해 단일 결과 행을 반환한다.

- group by 절을 생략하면 DB는 선택목록의 집계 함수를 쿼리된 테이블의 모든 행에 적용한다.

- select 절의 모든 요소는 group by 절의 표현식, 집계 함수를 포함하는 표현식 또는 상수만 가능

- 형식
  
  ```sql
  select columns
  from table_name
  where conditions
  group by grouping columns
  having grouping conditions
  order by col [ASC | DESC]
  ```
  
  **실행순서**는 512346. 꼭 외우기!

### having 절

- group by한 결과에 조건을 추가

- 쿼리의 실행 순서를 보면 where절이 group by절보다 먼저 실행되기 때문에 **aggregate 조건은 having절에 작성.**
  
  - where는 일반조건, having은 그룹조건.

- order  by는 가장 마지막에 실행되므로, 그룹함수가 사용된 상황에서도 별 문제없이 넣을 수 있다.

## Set Operator

### Set (집합연산자)

- 모든 집합 연산자는 동일한 우선순위를 갖는다.

- select 절에 있는 column의 개수와 type이 일치해야 한다.

## JOIN

### Join

- 둘 이상의 테이블에서 데이터가 필요한 경우 테이블 조인이 필요

- 일반적으로 join 조건을 포함하는 where 절을 작성해야 한다.
  
  - 테이블 개수가 n개일 때 최대 (n-1)개의 join 조건을 작성할 수 있고, 최소 1개의 조건은 주어져야 한다.

- join 조건은 **일반적으로** 각 테이블의 PK 및 FK로 구성됨.
  
  - PK: **unique + Not Null**. 중복을 허용하지 않는 유일한 값(근데 null 허용) +  null 제외
  
  - FK:  **foreign key**. 현재 테이블의 PK를 이용해 다른 테이블에 있는 값을 참조. 다른 테이블의 값을 변경하는 건 불과하고, null 참조는 가능.

### Join의 종류

- Inner join

- Outer join
  
  - left, right

- 조건 명시에 따른 구분으로 natural, cross join도 있다.

### 주의할 점

- Inner Join: 어느 테이블을 먼저 읽어도 결과가 달라지지 않아 MySQL 옵티마이저가 join의 순서를 조절해서 다양한 방법으로 최적화를 수행할 수 있다.

- Outer Join: 반드시 outer가 되는 테이블을 먼저 읽어야 하므로 옵티마이저가 join 순서를 선택할 수 없다.

- Join의 처리는 어느 테이블을 먼저 읽을 지 결정하는 것이 중요
  
  - 단, 옵티마이저가 발전하면서 이런 부분은 크게 안 중요해졌다.
  
  - 그리고 사실 이건 DBA가 해야하는 부분

## Join의 종류

### Inner join

- 가장 일반적인 join의 종류이며, 교집합

- 동등 join이라고 하며, N개의 테이블 join 시 N-1개의 join 조건을 필요로 한다.

- 형식: `inner join`, `on`을 사용.

- natural join은 on 절을 생략

### Outer join

- Left, Right, Full outer join으로 구분됨

- 어느 한 쪽 테이블에는 해당하는 데이터가 존재하는데, 다른 쪽 테이블에는 데이터가 존재하지 않을 경우 그 데이터가 검색되지 않는 문제점을 해결하기 위해 사용

## SubQuery

### 서브 쿼리

- 다른 쿼리 내부에 포함되어 있는 select 문을 의미함

- 서브 쿼리를 포함하고 있는 쿼리를 외부 쿼리 또는 메인 쿼리라고 부르며, 서브 쿼리는 내부 쿼리라고 부름

- 서브 쿼리는 비교 연산자의 오른쪽에 기술해야 하고, 반드시 괄호로 감싸져 있어야 한다.

- 종류: **중첩 서브 쿼리**, **인라인 뷰**, **스칼라 서브 쿼리**.
  
  - 중첩 서브 쿼리: where문에 작성. 단일 행, 복수(다중) 행, 다중 컬럼
  
  - 인라인 뷰: from 문에 작성.
  
  - 스칼라 서브쿼리: select 문에 작성.

#### 주의사항

- 반드시 ()로 감싸야 한다.

- 단일 행 또는 다중 행 비교 연산자와 함께 사용된다.

- 사용 가능한 곳: select, from, where, having, order by, insert문의 values, update문의 set

### 서브 쿼리 종류

#### Nested Subquery

- where절에 사용되는 서브 쿼리

- 서브 쿼리의 결과가 단일행을 리턴함

- 연산자 =, >, < 같은 거 사용 가능 (당연함)

#### Inline View

- From 절에 사용되는 서브 쿼리

- 서브 쿼리가 from절에 사용되면 뷰처럼 결과가 동적으로 생성된 테이블로 사용 가능.

- 임시적인 뷰이기 때문에 데이터베이스에는 저장되지 않는다.

- 동적으로 생성된 테이블이기 때문에 column을 자유롭게 참조 가능.

- **TopN 질의**.

#### Scalar Subquery

- Select 절에 있는 서브 쿼리

- 한 개의 행만 반환한다.

## Database Modelling

### DB Modelling

정보화 시스템을 구축하기 위해 어떤 데이터가 존재하는지, 또는 업무에 필요한 정보는 무엇인지 분석하는 방법.

**관계형 데이터베이스(RDBMS)** 는 이러한 "표"의 개념을 사용해서 데이터를 구성

### DB Modelling의 순서

업무 프로세스 - **개념적 모델링** - 개념적 구조 - **논리적 모델링** - 데이터 모델 - **물리적 모델링** - 물리적 데이터베이스 - **일치성 검토** - 업무 프로세스

- 순환 구조 형성

#### 개념적 데이터베이스 모델링

업무분석 단계에서 얻어진 내용을 토대로 우선 **Entity를 추출하고** Entity 내에 **속성(Attribute)을 구성**하며 Entity 간의 관계를 정의해서 **ER-Diagram**을 정의하는 단계

##### 과정

1. 사용자 부문의 처리현상 분석

2. 중요 실체와 관계를 파악하여 ERD 작성

3. 실체에 대한 상세 정의

4. 식별자를 정의하고, 식별자 업무규칙을 정한다.

5. 실체별로 속성을 상세화한다.

6. 필요한 속성 및 영역을 상세 정의한다.

7. 속성에 대한 업무규칙을 정의한다.

8. 각 단계를 마친 후 사용자와 함께 모델을 검토.

##### 상세

개체: 사용자와 관계 있는 주요 객체로써 업무 수행을 위해 데이터로 관리되어야 하는 사람, 사물, 장소, 사건 등 개체

- 찾는 법: 영속적으로 존재하는 것, 새로 식별이 가능한 데이터 요소를 가짐, 반드시 Arrtribute를 가져야 함, 명사적 표현

속성: 저장할 필요가 있는 실체에 관한 정보. 개체의 성질, 분류, 수량, 상태, 특성 등을 나타내는 세부사항

- 최종 DB 모델링 단계를 통해 테이블의 컬럼으로 활용
  
  - 유형: 기초속성, 추출속성, 설계속성

식별자: 한 개체 내에서 인스턴스를 유일하게 구분할 수 있는 단일 속성 또는 속성 그룹

- 후보키, 기본키, 대체키, 복합키, 대리키

- 기본키: 개체에서 각 인스턴스를 유일하게 식별하는 데 가장 적합한 키.
  
  - 해당 실체를 대표할 수 있고, 업무적으로 활용도가 높고, 길이가 짧아야 할 것

관계: 두 Entity 간의 업무적인 연관성 또는 관련 사실

- 분석: 각 Entity 간에 특정한 존재여부 결정

- E-R Diagram으로 관계를 설정하는 순서
  
  - 관계가 있는 두 실체를 실선으로 연결하고 관계를 부여
    
    - 관계의 이름은 마름모로 표현
  
  - 관계 차수를 표현
    
    - 차수성: 한 실체의 하나의 인스턴스가 다른 실체의 몇 개의 인스턴스와 관련될 수 있는가를 정의. 양쪽 방향 모두 조사해야 함
  
  - 선택성을 표시
    
    - 선택적인지 반드시인지를 표시. 항상 그 관계를 만족해야만 하는가

- 차수성의 종류: 일대일, 일대다, 다대다

#### 논리적 데이터베이스 모델링

개념적 모델링 단계에서 정의된 ER-Diagram을 **MappingRule**을 적용하여 관계형 데이터베이스 이론에 입각한 **스키마**를 설계하는 단계와, 이를 이용하여 필요하다면 정규화하는 단계로 구성

##### 구성

기본키 (Primary Key)

- 후보키 중에서 선택한 주 키

- 널 값을 가질 수 없다. `Not Null`

- 동일한 값이 중복해서 저장될 수 없다. `Unique`

참조키. 이웃키 (Foreign Key)

- 관계를 맺는 두 엔티티에서 서로 참조하는 릴레이션의 attribute로 지정되는 키

##### Mapping Rule

개념적 데이터베이스 모델링에서 도출된 개체 타입과 관계 타입의 테이블 정의

- 단순 엔티티가 테이블로

- 속성이 컬럼으로

- 식별자가 기본키로

- 관계가 참조키로

##### 정규화

Attribute 간 존재하는 함수적 종속성을 분석해서, 관계형 스키마를 더 좋은 구조로 정제해나가는 일련의 과정

데이터의 중복을 제거하고, 속성들을 본래의 제자리에 위치시키는 것

제1정규화, 제2정규화, 제3정규화로 구분된다.



1. 제1 정규화
   
   반복되는 그룹 속성을 제거한 뒤, 기본 테이블의 기본키를 추가해 새로운 테이블을 생성하고 기존의 테이블과 1:N의 관계를 형성하는 과정
   
   반복되는 그룹 속성이란 같은 성격과 내용의 column이 연속적으로 나타나는 column을 말함.
   
   - 부수적인 데이터를 저장하기 위해 **기본 데이터**가 중복되는 것을 테이블 분리로 해결

2. 제2 정규화
   
   복합키에 전체적으로 의존하지 않는 속성 제거.
   
   대상이 되는 테이블은 키가 여러 column으로 구성된 경우.
   
   복합키의 일부분에 의해 종속되는 것을 **부분적 함수 종속관계**라 하며 이를 제거하는 작업.

3. 제3 정규화
   
   기본키에 의존하지 않고 일반 컬럼에 의존하는 컬럼들을 제거.
   
   이행적 함수 종속관계를 갖는 컬럼을 제거한다.





## JDBC (Java Database Connectivity)

### JDBC란?

자바 프로그래밍 언어로 만들어진 클래스와 인터페이스로 이루어진 API로서, **ANSI SQL**을 지원

- Application Platform Interface.

SQL문을 실행할 수 있는, **함수 호출 인터페이스**



### 특징

DBMS 종류에 독립적인 자바 프로그래밍이 가능하다.

데이터베이스가 달라지더라도, 동일한 API를 사용하게 해준다.

- 드라이버, URL만 수정하면 DB가 달라져도 잘 돌아간다는 뜻

자바가 가지는 **플랫폼에 독립적**이라는 특성과 **DBMS에 독립적**이라는 특성을 가진다.





### JDBC Programming 개발 순서

1. JDBC Driver Loading

2. DBMS와 연결 (Connection 생성)

3. SQL 실행 준비 (Statement, PreparedStatement 생성)

4. SQL 실행
   
   DML(insert, update, delete) -> return int
   
   Query(select) -> return select

5. DBMS 연결 끊기
   
   SQL exception을 방지하기 위해서는 연결을 끊을 때 **순서**가 엄청 중요하다.



#### JDBC Driver Loading

데이터베이스와의 접속을 오픈하기 위해 어플리케이션의 JVM 안으로 특정 드라이버 클래스를 적재함

`Class.forName(Driver ClassName);`



##### 

#### DBMS와 연결

DriverManager 클래스를 이용해 URL 형태로 주어진 DB에 대한 접속을 요청



#### SQL 실행 준비
