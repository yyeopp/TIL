# HTTP 상태코드

---

## 소개

클라이언트가 보낸 요청의 처리 상태를 응답에서 알려주는 기능.

- 1xx : Informational. 요청 수신 후 처리 중

- 2xx : Successful. 요청 정상 처리

- 3xx : Redirection. 요청을 와료하려면 추가 행동이 필요

- 4xx : Client Error. 클라이언트 오류

- 5xx : Server Error. 서버 오류

### 모르는 상태 코드가 나타나면?

서버가 반환한 상태코드를 클라이언트가 모르는 경우?

**상위 상태코드로 해석해서 처리**

- 2xx면 어쨌든 성공한 건 맞다.

상태코드가 계속 추가되더라도, 클라이언트쪽 변경이 필요없다는 장점

### 1xx (Informational)

요청이 수신되어 처리 중

사용하지 않음

---

## 2xx - 성공

**클라이언트의 요청을 성공적으로 처리**

대표적인 종류는 아래와 같음.

- 200 OK

- 201 Created

- 202 Accepted

- 204 No Content

### 200 OK

일반적인 성공

GET 조회 성공 등

### 201 Created

요청 성공 후 **새로운 리소스가 생성됨**

생성된 리소스를, 응답의 **Location 헤더 필드**로 리턴해줌

### 202 Accepted

요청이 접수되었으나 처리가 완료되지 않았음

**배치** 같은 곳에서 사용

### 204 No Content

서버가 요청을 성공적으로 수행했으나, 응답 페이로드에 넣을 데이터가 없음.

특정 버튼을 눌렀을 때 별도의 redirect 없이 **화면을 유지해야할 때** 사용.

- 통신 및 처리는 성공했으나, 결과값이 비어있어야 하는 케이스

---

## 3xx - 리다이렉션

**요청을 완료하기 위해 유저 에이전트의 추가 조치 필요**

### 리다이렉션?

웹 브라우저는, 3xx 응답의 결과에 **Location 헤더**가 있는 경우 해당 위치로 자동 리다이렉션하게 된다.

원래 사용 중이던 특정 URI를 서버에서 사용하지 않고, 다른 URI로 대체해서 제공 중인 경우에 사용함.

### 리다이렉션 종류

#### 영구 리다이렉션

특정 리소스의 URI가 영구적으로 이동

#### 일시 리다이렉션

일시적인 변경.

- 주문 완료 후 주문 내역 화면으로 이동

#### 특수 리다이렉션

결과 대신 캐시를 사용하는 경우

### 영구 리다이렉션 - 301, 308

리소스 URI가 **영구적으로 이동**

원래 URL은 사용 불가 처리. 검색 엔진 등에서도 변경을 인지하게 됨

- **301** Moved Permanently
  
  - 리다이렉트 시, 요청 메서드가 **GET**으로 **변할 수 있고**. **바디가 제거될 수 있음**
  
  - 기존 페이지 사용 불가 처리, 완전히 새로운 페이지로 랜딩시키는 개념

- **308** Permanent Redirect
  
  - 리다이렉트 시 요청 메서드와 바디를 **유지함**
  
  - 새로운 페이지로 랜딩은 시키되 요청 데이터 그대로 전달하여 서버 내 프로세스를 돌려줌
  
  - 실무적으로 거의 사용하기 어렵다.
    
    - 상식적으로 새로운 페이지면 POST 메서드에서 요구하는 데이터 인터페이스도 변경되기 때문

### 일시 리다이렉션 - 302, 307, 303

리소스의 URI가 **일시적으로 변경**

검색 엔진 등에서 URL을 변경하면 안 된다.

- **302** Found
  
  - 리다이렉트 시 요청 메서드가 **GET**으로 **변할 수 있고**, **바디가 제거될 수 있음**

- **307** Temporary Redirect
  
  - 302와 같은 기능이지만,
  
  - 리다이렉트 시 요청 메서드와 바디를 **유지함.**

- **303** See Other
  
  - 302와 같은 기능이지만,
  
  - 리다이렉트 시 요청 메서드가 GET으로 **변경함.**

이론상 엄밀한 코드인 307과 303을 정확히 써주면 좋긴 하겠지만,

**실무적으로는 대부분 302**만 적용시키고 있다.

### PRG: Post/Redirect/Get

**일시적인 리다이렉션의 예시**

웹 브라우저 새로고침을 통해, 민감한 POST 서비스를 중복으로 실행시키는 것을 방지하는 기법

#### 사용 전

상품 주문 시, 단순 POST 메서드로 요청을 보내고 응답에 **200**을 찍어준다면?

- 결과 화면이 뜰 수는 있는데,

- 그걸 새로고침했을 때 동일한 POST 메서드가 들어가게 될 것. 중복 주문 발생

- 물론 서버에서 막는 게 바람직하지만, PRG는 **클라이언트** 수준에서 이를 방지하는 기

#### PRG 적용법

POST 주문 후, 주문 결과 하면을 **GET 메서드로 리다이렉트**

- 새로고침을 눌러도 리다이렉트 된 GET 메서드만 실행됨.

### 상세

- **POST** 요청의 성공 응답을 **302 Found**로 주면서, **Location** 값을 주문 결과 페이지로 주는 것.

- 브라우저는 그걸 받아서 자동 **Redirect** 처리
  
  - **GET** 메서드로 주문 결과 화면을 요청하게 됨

- 서버는 GET 메서드에 대한 주문 결과 화면을 리턴 (200)
  
  - 새로고침을 눌러도 계속 여기서만 머물게 된다.

### 정리 - 302, 307, 303

#### 역사를 짚자면..

처음 302 코드의 스펙 의도는 **HTTP 메서드를 유지하는 것**이였다.

근데 대부분의 웹 브라우저가 GET으로 바꿔버렸음

때문에 302를 보완하는 명확한 기능을 가진 307, 303을 만든 것.

#### 현실적으로..

이미 많은 애플리케이션 라이브러리는 302를 사용 중.

리다이렉션 시 GET으로 변해도 상관 없다면, 그냥 302 쓰자

### 기타 리다이렉션 - 300, 304

- 300 Multiple Choices: 안 씀

- **304** Not Modified
  
  - **캐시** 목적으로 사용
  
  - 클라이언트에게 **리소스가 수정되지 않았음**을 알려주는 코드.
    
    - 이 때 클라이언트는 로컬PC 캐시를 재사용한다.
    
    - 캐시로 **리다이렉트**치는 방식
  
  - 즉, 304 응답에는 바디값이 없어야 한다.
  
  - **조건부 GET, HEAD** 요청 시의 응답으로 사용

---

## 4xx, 5xx

### 4xx (Client Error)

**클라이언트**의 요청에 잘못된 문법이 있는 등의 이유로 서버가 요청을 수행할 없음

**오류 원인이 클라이언트에 있음**

- **단순 재시도**는 거의 무조건 실패

#### 400 Bad Request

클라이언트가 잘못된 요청을 해서, 서버가 요청을 처리할 수 없음.

- 파라미터가 틀렸거나 API 스펙이 맞지 않거나

- 서버 개발자 쪽에서 정확한 오류처리가 필요한 상태코드

#### 401 Unauthorized

클라이언트가 해당 리소스에 대한 **인증**이 필요함.

- **인증**: Authentication. 본인이 **누구인지** 확인 (로그인)

- **인가**: Authorization. **권한부여**. 로그인 이후의 문제

- 해당 코드의 오류 메시지가 Unauthorized인데, 사실 **Unauthenticated가 보다 정확하다.**
  
  - 쉽게 말해, 로그인 안 된 경우 뜨는 코드

#### 403 Forbidden

서버가 요청을 이해했지만, **승인을 거부함**

- **인가**에 실패한 케이스.

- 인증은 됐으나 **접근 권한이 불충분**

#### 404 Not Found

요청한 리소스 **자체가 서버에 없음**

- 클라이언트가 권한이 부족한 리소스에 접근할 때 사용하기도 한다.

- 아예 숨겨버리는 의미

### 5xx (Server Error)

**서버 문제**로 오류 발생.

단순 재시도가 성공할 **수도** 있음.

#### 500 Internal Server Error

서버 내부 문제로 오류 발생.

애매하면 다 500

#### 503 Service Unavailable

서버가 일시적인 과부하나 예정된 작업으로, **잠시** 요청을 처리할 수 없음.

**Retry-After** 헤더 필드에 복구 예정 시점을 써주는 게 가능하기도 함

- 실무적으로 적용하기 쉽지는 않을 것




