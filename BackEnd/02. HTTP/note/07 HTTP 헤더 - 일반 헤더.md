# HTTP 헤더 - 일반 헤더

---

## HTTP 헤더 개요

### 용도

HTTP 전송에 필요한 모든 부가 정보 (메타데이터)가 들어간다.

표준 헤더는 엄청 많고,

임의의 헤더도 추가해서 전송할 수 있다.

### RFC2616 (과거)

#### 분류

- General: 메시지 전체에 적용되는 정보
  
  - Connection: close

- Request: 요청 정보
  
  - User-Agent: Mozilla/5.0

- Response: 응답 정보
  
  - Server: Apache

- **Entity**: 엔티티 **바디** 정보
  
  - Content-Type: application/json

#### HTTP BODY

RFC2616에서 message body는, **entity body**를 전달하는 개념으로 사용.

**entity heade**r는 entity body의 데이터를 해석할 수 있는 정보를 제공하는 의미

- 데이터 유형, 데이터 길이, 압축 정보 

### RFC723X (현재)

#### 변화

엔티티라는 개념이 **표현**(Representation)으로 대체됨

Representation = representation Metadata + Representation Data

#### HTTP BODY

message body는, **표현 데이터**를 전달하는 개념으로 사용.

- message body를 **payload**라고도 부른다.

이 때 **표현**은, 요청이나 응답에서 전달할 실제 데이터.

**표현 헤더**는, **표현 데이터**를 해석할 수 있는 정보

- 왜 *표현* 인가?

- HTML 표현 데이터는 **리소스**를 HTML 이라는 형태로 **표현**한 것이기 때문.

- JSON으로 응답이 내려와도 마찬가지

---

## 표현

- Content-Type: 표현 데이터의 형식

- Content-Encoding: 표현 데이터의 압축 방식

- Content-Language: 표현 데이터의 자연 언어

- Content-Length: 표현 데이터의 길이

### Content-Type

표현 데이터의 **형식**

payload에 뭐가 들어가있는가

- text/html;charset=utf-8

- application/json

- image/png

### Content-Encoding

표현 데이터의 **인코딩**

데이터 압축 및 압축 해제를 위한 인코딩 헤더

- gzip 등

### Content-Language

표현 데이터의 **자연 언어**.

다국어 지원 웹에서 활용

- ko, en, en-US 이런 식

### Content-Length

표현 데이터의 **길이**

바이트 단위로 써놓게 됨

---

## 콘텐츠 협상

**클라이언트가 선호하는 표현을 요청하는 헤더**

- Accept: 클라이언트가 선호하는 미디어 타입 전달

- Accpet-Charset: 클라이언트가 선호하는 문자 인코딩

- Accept-Encoding: 클라이언트가 선호하는 압축 인코딩

- Accept-Language: 클라이언트가 선호하는 자연 언어

이러한 **협상 헤더**는, **요청 시**에만 사용한다.

### 협상과 우선순위

#### Quality Values (q)

`Accept-Language: ko-KR,ko-KR;q=0.9,en-US;q=0.8`

- 이런 형태로, 여러 개의 협상 선택지를 **우선순위와 함께** 전달할 수 있다.

- q값은 0부터 1 사이의 값을 가질 수 있다.

- 클수록 **높은 우선순위**를 뜻한다.

- 생략 시 1

#### 구체적인 것이 우선한다.

`Accept: text/*,text/plain,text/plain;format=flowed,*/*`

- 이런 식으로 보냈을 때, 가장 specific한 값이 우선순위가 높음

---

## 전송 방식

단순 전송, 압축 전송, 분할 전송, 범위 전송

### 단순 전송

Content-Length가 고정되는 케이스.

별도 압축 같은 것 없음

### 압축 전송

Content-Encoding이 적용되는 케이스.

Length 값은 변하게 될 것

### 분할 전송

**Transfer-Encoding: chunked**

용량이 큰 데이터를 분할해서 전송

Content-Length는 예상 불가하므로 넣으면 안 된다.

### 범위 전송

Range, Content-Range

이미지 파일 같은 것을 연속적으로 전송할 때 사용

---

## 일반 정보

단순 정보성 헤더

### From

유저 에이전트의 **이메일 정보**

일반적으로 잘 사용하지 않음.

요청 시에만 사용

### Referer

**이전 웹 페이지의 주소**

현재 요청된 페이지의 바로 이전 웹 페이지 주소.

**유입 경로** 분석 가능.

요청 시에만 사용

> Referrer라고 하는 게 맞는데 오타임..

### User-Agent

유저 에이전트의 애플리케이션 정보

- 웹 브라우저, OS 등등

서버 입장에서는 어떤 클라이언트에게서 장애가 발생하는지 파악하는 데 사용 가능

혹은 통계 정보.

요청 시에만 사용

### Server

요청을 처리하는, ORIGIN 서버의 소프트웨어 정보

- 중간중간의 프록시, 캐시 서버 다 빼고 ORIGIN

응답 시에만 사용

### Date

메시지가 발생한 날짜와 시간

응답 시에만 사용

---

## 특별한 정보

### Host

요청한 **호스트 정보**

요청에서만 사용하는데, **필수** 헤더다.

**하나의 서버**가 **여러 도메인**을 나누어 처리해야 할 때 식별하기 위함

- 1개 IP 주소, n개의 도메인 주소

- **v-host**

웹서버가 요청을 받으면, Host에 기입된 도메인 정보를 읽고 그에 부합하는 서비스로 연결시켜준다.

- **가상 호스팅**이라는 개념

### Location

페이지 리다이렉션

웹 브라우저가 3xx 응답을 받을 때, Location 헤더가 있을 시 자동으로 리다이렉션이 일어남

### Allow

허용 가능한 HTTP 메서드

**405** 응답이 있을 때 Allow 헤더가 포함되기도 함

- 이 서버에서 사용하는 메서드는 GET, POST 에요

### Retry-After

유저 에이전트가 다음 요청을 하기까지 기다려야 하는 시간

**503** 응답에 포함될 수 있음.

---

## 인증

### Authorization

클라이언트 인증 정보를 서버에 전달

인증 방식에 따라, value값에 온갖 것들이 들어가게 된다.

### WWW-Authenticate

리소스 접근 시, 필요한 인증 방법을 정의

**401** 응답과 함께 사용될 수 있음

---

## 쿠키

HTTP는 기본적으로 Stateless 프로토콜이기 때문에, 별다른 조치가 없을 시 클라이언트의 상태는 서버가 유지하지 않는다.

이게 문제가 되는 지점은, **사용자의 로그인**

- 별도의 방법이 없다면 모든 요청에 사용자 정보를 포함시키든가 해야한다.

- 당연히 문제가 많음

### 쿠키를 사용하는 로그인

`Set-Cookie: user=홍길동`

로그인 성공 응답에 위와 같은 **쿠키 헤더**를 포함시킨다.

브라우저는 이걸 받아서, **쿠키 저장소**에 Set 한다.

그 이후 해당 웹 페이지에 접근할 때,

- 브라우저는 무조건 쿠키 저장소를 뒤져서

- 가지고 있는 Cookie값을 싹 긁어서

- 웹 페이지로 보내는 모든 요청에 `Cookie` 라는 헤더값으로 포함시킨다.

### 상세

#### 사용처

사용자 로그인 세션 관리

광고 정보 트래킹

#### 쿠키 정보는 항상 서버에 전송된다

네트워크 트래픽을 추가로 유발한다고 봐야 함.

- 최소한의 정보를 사용할 필요 (세션 id, 인증 토큰 정도)

서버에 전송하는 게 아니라, 브라우저 내부에 데이터를 단순 저장하고 싶다면 **웹 스토리지**를 사용하는 게 바람직

- localStorage, sessionStorage

#### 주의사항

보안에 민감한 데이터는 **절대 저장하지 말자**

### 쿠키 - 생명주기

**Set-Cookie** 헤더에 파라미터값으로 생명주기 데이터를 보내줄 수 있다.

- **expires**
  
  - 만료일 지정

- **max-age**
  
  - 초 단위로 지정
  
  - 0이나 음수를 넣으면 즉시 삭제

세션 쿠키: 만료 날짜 생략하면, 브라우저 종료 시까지만 유지

영속 쿠키: 만료 날짜 입력하면, 해당 날짜까지 유지

### 쿠키 - 도메인

마찬가지로 Set-Cookie 헤더에 입력 가능한 파라미터값

해당 쿠키에 접근 가능한 도메인 식별자를 직접 입력하는 것.

- `domain=example.org`

### 쿠키 - 경로

Set-Cookie 헤더 파라미터값

- `path=/home`

이 경로를 포함하는 **하위 경로 페이지만** 쿠키 접근이 가능함

일반적으로는 `/`으로 지정하게 된다.

### 쿠키 - 보안

#### Secure

쿠키는 원래 http, https를 구분하지 않으나,

Secure 적용 시 https 일 때만 전송함

#### HttpOnly

XSS 공격을 방지.

자바스크립트에서는 접근이 불가하다.

- document.cookie 로 접근 불가

#### SameSite

XSRF 공격을 방지.

요청 도메인과, 쿠키에 설정된 도메인이 같은 경우만 쿠키를 전송하도록 지정






