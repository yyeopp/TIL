# 로그인 처리 - 쿠키, 세션

---

## 로그인 처리하기 - 쿠키 사용

### 쿠키

서버에서 로그인에 성공했을 시, HTTP 응답에 쿠키를 담아서, 브라우저에 전달

브라우저는 그 이후로 해당 쿠키를 **모든 요청에 지속적으로 보냄**

### 영속 쿠키와 세션 쿠키

영속 쿠키

- 만료 날짜를 입력, 해당 날짜까지 유지

세션 쿠키

- 만료 날짜를 생략, 브라우저 종료시까지 유지.

### 예제 코드 요약

- 로그인 성공 시, member의 ID값을 Cookie로 말아서 `response`에 세팅한다.

- 브라우저를 통해, 클라이언트의 모든 요청 header에 Cookie가 포함되는 것을 확인 가능하다.

- 로그인된 홈화면과 기본 홈화면을 분기하기 위해, 컨트롤러에서 `@CookieValue` 를 사용해 쿠키값의 존재 유무를 검증할 수 있다.

- 로그아웃 기능을 제공하고자 한다면, 쿠키를 제거해줘야 한다.
  
  - 생성했던 Cookie의 `MaxAge` 값을 0으로 변경하는 방식으로 다시 세팅하면 된다.

단, 이러한 단순한 로그인 방식은 **보안 문제가 심각하다**.

---

## 쿠키와 보안 문제

### 보안 문제

- 쿠키 값은 클라이언트에서 **임의로 변경**할 수 있다.
  
  - 다른 사용자로 변조하는 게 너무 쉽다.

- 쿠키에 보관된 정보가 **유출될 가능성**

- 쿠키를 한번 가져가면, 계속 사용할 수 있음
  
  - 악의적인 요청을 시도할 가능성

### 대안

- 쿠키에 애초에 중요한 값을 노출하면 안 된다.
  
  - 예측이 불가능한 임의의 랜덤값을 사용해야 함
    
    - 서버에서 따로 실제 id값과 매칭하도록.

- 토큰이 유출되더라도, **적절한 타임아웃**을 두어서 서버에서 강제로 제거해야 한다.

---

## 로그인 처리하기 - 세션 동작 방식

### 목표

애초에 중요한 정보는, 모두 서버에 저장하는 것이 맞다.

클라이언트와 서버 간의 연결은 **추정 불가능한 임의의 식별자 값**으로 이루어져야 한다.

### 세션 동작 방식

서버에서, **세션 저장소**를 생성하고 관리한다.

- `Map` 형태의 자료구조로 보면 된다.

로그인 성공 시, `UUID` 같은 랜덤값을 생성하여 사용자 정보와 매핑해 세션에 저장한다.

클라이언트 측에는 **세션**값을 쿠키로 전달하고, 그 이후 요청에서는 세션 저장소에서 매핑하여 사용한다.

- 회원과 관련된 정보가 클라이언트에 전혀 전달되지 않는다는 점이 중요

- 세션 ID값이 전달되지만, **추정이 불가능한 정보**이다.

### 정리

세션을 사용하면 편리하게 여러 보안 문제를 해결할 수 있다.

- 쿠키값을 변조하더라도 의미가 없다.

- 쿠키가 탈취되더라도, 그 자체로는 중요한 정보가 없다.

- 서버에서 세션 만료시간을 짧게 유지함으로써, 유출된 쿠키가 지속적으로 사용되지 않도록 한다.

---

## 로그인 처리하기 - 세션 직접 만들기

세션 관리가 필요로 하는 3가지 기능

- 세션 생성

- 세션 조회

- 세션 만료


