# Cookie & HttpSession

## Http protocol의 특징

client과 server에 요청을 하면, server는 그에 대한 처리를 한 후 client에게 응답한 뒤, **연결을 해제한다.**

지속적인 연결로 인한 자원낭비를 줄이기 위한 것인데, client와 server가 연결 상태를 유지하는 것이 **필요한 경우** 문제가 발생한다. 대표적인 게 **로그인 여부**

즉, client 단위로 **어떤 상태 정보를 유지해야 하는 경우** Cookie와 Session이 사용된다.

- HTTP protocol의 특징(약점)을 보완하기 위해 사용

## Cookie

### 개요

`javax.servlet.http.Cookie`

서버에서 사용자의 컴퓨터에 저장하는 정보파일

사용자가 별도의 요청을 하지 않아도, 브라우저는 request 시 Request Header를 넣어 자동으로 서버에 전송한다.

key와 value로 구성된 String 형태.

Browser마다 저장되는 쿠키는 다르다.

### 사용 목적

**세션관리**: 사용자 아이디, 접속시간 등 서버가 알아야 하는 정보 저장

**개인화**: 사용자마다 다르게 그 사람에 적절한 페이지를 보여준다.

**트래킹**: 사용자의 행동과 패턴을 분석하고 기록한다.

### 구성 요소

이름, 값, 유효기간, 도메인, 경로(path)

### 동작 순서

1. client가 페이지를 요청

2. WAS가 Cookie를 생성

3. HTTP Header에 cookie를 넣어 응답

4. Browser는 넘겨받은 cookie를 PC에 저장하고, 다시 WAS에 요청할 때 요청과 함께 cookie를 전송

5. Browser가 종료되어도, cookie의 만료 기간이 남아 있다면 client는 계속 보관

6. 동일 사이트 재방문 시 cookie가 있는 경우, 요청 페이지와 함께 cookie를 전송

## HttpSession

### 개요

`javax.servlet.http.HttpSession`

방문자가 웹 서버에 접속해 있는 상태를 하나의 단위로 보고, 그것을 세션이라 한다.

WAS의 메모리에 Object 형태로 저장됨.

memory가 허용하는 용량까지 제한 없이 저장이 가능

사용 예시: site 내에서 화면을 이동해도, 로그인(사용자 정보)이 풀리지 않고 유지되는 상황

### 동작 순서

1. client가 페이지를 요청

2. 서버는 접근한 클라이언트의 cookie를 확인해, 클라이언트가 해당 session-id를 보냈는지 확인

3. session-id가 존재하지 않으면, 서버가 session-id를 생성해 클라이언트에게 return

4. 서버에서 클라이언트로 돌려준 session-id를 쿠키를 사용해 **서버에 저장**. 이름은 **JSESSIONID**

5. 클라이언트 재접속 시, 이 쿠키를 이용해 session-id 값을 서버에 전달

### 특징

웹 서버에 웹 컨테이너의 상태를 유지하기 위한 정보를 저장. 웹 서버에 저장되는 쿠키 = 세션 쿠키

브라우저를 닫거나, 서버에서 세션을 삭제했을 때만 삭제되기 때문에 쿠키에 비해 보안이 좋다.

저장 데이터에 제한이 없다.

각 클라이언트에 고유 Session ID를 부여하게 된다.

이를 통해 클라이언트를 구분하고 각 클라이언트 요구에 맞는 서비스를 제공할 수 있다.

아이디 또는 닉네임 같ㅌ이, 로그인 시 자주 사용되는 정보를 session에 저장하면 매번 DB에 접근할 필요가 없어 효율적이다.
