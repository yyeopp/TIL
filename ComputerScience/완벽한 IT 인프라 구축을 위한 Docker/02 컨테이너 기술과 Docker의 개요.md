# Chapter 02: 컨테이너 기술과 Docker의 개요

---

Docker는 기본적으로 **컨테이너** 기술을 사용해 어플리케이션의 **실행 환경**을 구축 및 운용하는 플랫폼이다.

어플리케이션의 실행에 필요한 것을 모아 **이미지**로 관리함으로써 어플리케이션의 **이식성**을 높일 수 있다.

---

## 컨테이너 기술의 개요

### 컨테이너

컨테이너는, 호스트 OS 상에 **논리적인 구획**(컨테이너)을 만들고, 어플리케이션 작동을 위해 필요한 라이브러리나 어플리케이션 등을 하나로 모아 **마치 별도의 서버인 것처럼 사용할 수 있게** 만든 것이다.

호스트 OS의 **리소스**를 **논리적으로 분리**시키고 여러 개의 컨테이너가 공유하여 사용한다.

- 하드웨어와 OS 위에 **컨테이너 관리용 소프트웨어**를 두고,

- 그 위에 존재하는 컨테이너들은 **미들웨어**와 **어플리케이션**을 담고 있는 구조.

- 기본적으로 **가상머신**에 비해 오버헤드가 적기 때문에 가볍고 고속으로 작동한다는 특징이 있다.

일반적인 물리 서버 상 호스트 OS에 설치된 여러 어플리케이션들은, 동일한 시스템 리소스를 사용한다.

- 데이터를 저장하는 디렉토리, 동일한 서버 IP, 등

- 그런데 각 어플리케이션이 사용하는 미들웨어나 라이브러리의 버전은 다를 수 있고, 이것이 다른 어플리케이션에게 영향을 주지 않도록 주의를 기울일 필요가 있다.

이에 반해 컨테이너 기술이 적용되면 OS, 디렉토리, IP 주소 가튼 **시스템 자원**을 **마치 각 어플리케이션이 점유하고 있는 것처럼** 보이게 할 수 있다.

어플리케이션 실행에 필요한 모듈을 컨테이너로 모을 수 있기 때문에, 아예 여러 개의 **컨테이너를 조합**하여 하나의 어플리케이션으로 구축하는 **마이크로서비스형 어플리케이션**과 친화성이 높다.

> ### 서버 가상화 기술의 이모저모
> 
> 클라이언트 PC에서 사용되는 서버 가상화 기술은 크게 두 가지로 나뉜다.
> 
> #### 호스트형 서버 가상화
> 
> 하드웨어 상에 베이스가 되는 **호스트 OS**를 설치하고, 그 위에 **가상화 소프트웨어**를 설치한 뒤, 그 위에 **게스트 OS**를 작동시키는 기술이다.
> 
> 가상화 소프트웨어 설치만으로 비교적 간단한 가상 환경 구축이 가능하기 때문에, 개발 환경 구축에 주로 사용된다.
> 
> 컨테이너와 달리 호스트 OS 상에서 다른 OS를 또 움직여야 하므로, **오버헤드**가 크다.
> 
> #### 하이퍼바이저형 서버 가상화
> 
> 하드웨어 상에 **가상화를 전문으로  수행하는 소프트웨어**인 **하이퍼바이저**를 배치하고 그 위에 가상 환경(**게스트 OS**와 미들웨어, 어플리케이션)들을 두는 방식.
> 
> 호스트 OS 없이 하드웨어를 직접 제어하기 때문에 자원이 효율적으로 사용된다.
> 
> - 주로 클라우드의 가상 머신에서 사용되는 방법이다.
> 
> 대신 **가상 환경마다 별도의 OS**가 작동하기 때문에 가상 환경 **시작** 시 걸리는 오버헤드가 크다.
> 
> 하이퍼바이저형은 펌웨어로 구축하는 경우가 많다.
> 
> #### 컨테이너 기술과 가상화 기술
> 
> 서로 매우 비슷한데, 목적이 다르다.
> 
> - 컨테이너 기술은, 어플리케이션의 **실행 환경**을 모음으로써 **이식성**을 높이고 **확장성이 좋은 환경**에서 작동하는 것을 지향한다.
> 
> - 가상화 기술은, 대부분 **서로 다른 환경**을 어떻게 **효율적으로 에뮬레이트**할 지를 지향하고 있다.

### 컨테이너 역사

#### FreeBSD Jail

오픈소스 Unix인 FreeBSD의 기술이다.

FreeBSD 시스템을 Jail이라 부르는 **독립된 작은 구획**에 가둬넣어 **시스템을 분할**하는 기술이다.

##### 프로세스의 구획화

프로세스는 똑같은 Jail 내에서 작동하는 프로세스에만 액세스가 가능하도록, 프로세스를 분리한다.

##### 네트워크의 구획화

Jail은 각각 IP 주소가 할당되어 있고, 여러 개의 주소를 할당받을 수도 있다.

Jail 외부에는 네트워크를 경유해야만 엑세스가 가능하다.

- VIMAGE라는, **네트워크 스택을 가상화**하는 기술을 사용해 구현하고 있다.

##### 파일 시스템의 구획화

Jail마다 파일 시스템을 구획화하여 조작할 수 있는 명령이나 파일 등을 제한한다.

Jail 내에서 관리자 권한을 받더라도, 그 권한이 Jail 안으로 제한되기 때문에 **시스템 종료** 같이 시스템 전체를 조작하는 권한은 가질 수 없다.

- 일반 사용자이면서도 관리자 권한이 부여될 수 있다는 점에서 장점이 있다.

#### Solaris Containers

Oracle의 상용 Unix인 Solaris에서 사용하는 컨테이너 기술.

다음 두 가지 기능으로 구성되어 있다.

##### Solaris Zone 기능

하나의 OS 공간을 **가상적으로 분할**하여 **여러 OS가 작동하고 있는 것처럼 보여주는** **소프트웨어 파티셔닝** 기능.

Solaris 환경을 독립된 여러 개의 존으로 구획하고, 이렇게 구획된 **가상 존**을 **비 글로벌 존**(**non-global zone**)이라고 한다.

- 비 글로벌 존에서 미들웨어와 함께 업무 어플리케이션을 작동시킬 수 있고,

- 존끼리는 완전히 격리되어 있어, 다른 존에 있는 프로세스에 액세스할 수 없다.

- 이러한 구조는 Docker와 아주 비슷하다.

한 대의 물리 서버 안에 최대 8192개의 가상 Solaris 환경 구축이 가능하다.

##### Solaris 리소스 매니저 기능

비 글로벌 존에서 CPU나 메모리 같은 **하드웨어 리소스를 배분**하는 관리 기능.

중요도가 높은 업무 시스템에 우선적으로 리소스를 할당할 수 있다.

#### Linux Containers (LXC)

Linux 상에서 사용하는 컨테이너 환경을 LXC라고 한다.

LXC는 Linux 커널의 컨테이너 기능을 이용하기 위한 툴과 API를 제공한다.

- 컨테이너는 namespace와 cgroups라는 **리소스 관리 장치**를 사용해 분리된 환경으로 만들어지고,

- 데이터 영역에서는 특정 디렉토리를 **루트 디렉토리로 변경**하는 chroot를 사용해 분리 환경을 만든다.

Docker 과거 버전은 내부적으로 LXC를 사용했었다.

---

## Docker의 개요

Docker는, 어플리케이션 실행에 **필요한 환경**을 **하나의 이미지로 모아**두고, 그 이미지를 사용해 **다양한 환경**에서 어플리케이션 **실행 환경을 구축 및 운용**하기 위한 오픈소스 플랫폼이다.

내부적으로 **컨테이너 기술**을 사용하는 것이 중요하다.

### 프로그래머에게 Docker란?


