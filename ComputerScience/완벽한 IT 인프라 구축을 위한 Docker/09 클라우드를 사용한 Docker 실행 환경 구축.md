# Chapter 09: 클라우드를 사용한 Docker 실행 환경 구축

---

Docker는 이미지만 있으면 동일한 인프라 환경에서 어플리케이션을 가동시킬 수 있다.

즉, 온프레미스부터 프라이빗 클라우드, 퍼블릭 클라우드 등 실행 환경을 **요구사항에 맞춰** 자유롭게 선택하면 된다.

이를 통한 어플리케이션의 **높은 이식성**이 최대의 강점이다.

- GCP의 매니지드 서비스인 Google Kubernetes Engine (GKE)를 사용해 Docker 실행 환경을 구축하는 것이 하나의 예시가 될 것.

---

## 클라우드 환경에서 Docker 오케스트레이션하기

주요 퍼블릭 클라우드 업체는 Docker 오케스트레이션을 위해 다양한 서비스를 제공하고 있다.

### 분산 환경에서의 컨테이너 운용 관리

멀티호스트로 구성된 실제 환경을 **클러스터 구성**으로 가동시키려면 컨테이너 조작뿐만 아니라 호스트 간 네트워크 연결, 스토리지 관리, 컨테이너를 어떤 호스트에서 가동시킬지 같은 **스케줄링** 기능이 필요하다. 컨테이너 정상 작동 여부를 감시할 장치도 필요하다.

- 이러한 기능을 갖추어 컨테이너를 통합 관리할 수 있는 툴을 **컨테이너 오케스트레이션 툴**이라고 한다.

#### Kubernetes

google의 엔지니어를 중심으로 개발되고 있는 오픈소스 컨테이너 오케스트레이션 툴.

제공하는 기능도 풍부하고 개발 속도가 빠르며, 도입 실적도 풍부하여 실질적인 스탠다드다.

#### Docker Engine (Swarm 모드)

Docker 자체적으로 클러스터링 기능을 제공하는 Swarm 모드가 있다. 이를 통해 여러 개의 컨테이너를 멀티호스트 환경에서 작동시키고, 하나의 명령으로 조작할 수 있다.

#### Apache Mesos, Marathon

Mesos는 오픈소스 클러스터 오케스트레이션 툴로, 몇 천 대의 호스트도 지원 가능하도록 설계되어 있다.

- 여러 호스트의 CPU나 메모리, 디스크를 추상화하여 하나의 리소스 풀로 다룰 수 있다.

**컨테이너** 오케스트레이션에 사용하려면 별도의 프레임워크가 필요한데, Marathon이 사용된다.

- 장기간에 걸쳐 계속 작동하는 어플리케이션의 실행이나 모니터링을 할 수 있다.

### 퍼블릭 클라우드가 제공하는 매니지드 서비스

일반적으로 클러스터 환경을 직접 구축하고 운용하는 것은 기술적인 난이도가 높다. 운용에 걸리는 부하 또한 시스템이 커질수록 기하급수적으로 커진다.

그래서, 충분한 스킬과 경험이 없는 경우 Docker 컨테이너를 제품 환경에서 운용할 때 **퍼블릭 클라우드가 제공하는** 매니지드 서비스를 이용하는 것이 좋다.

- 이를 통해 인프라에 관한 깊은 지식이나 경험이 없어도 높은 가용성을 가진 클러스터 환경에서 컨테이너를 운용할 수 있다.

#### Amazon EC2 Container Service

AWS EC2를 사용하는 Docker 컨테이너 관리 서비스이다.

Amazon ECS에서는 **태스크 정의**라고 하는 JSON 탬플릿을 사용해 환경을 정의한다. 

- Docker 리포지토리, 이미지, 메모리, CPU 같은 하드웨어 요구사항이나 데이터 볼륨 스토리지, 컨테이너 간 연결 등을 정의한다.

- CPU, 메모리 같은 리소스와 가용성 요구사항을 바탕으로, 클러스터 전체에 컨테이너를 배치하는 **스케줄러**도 갖추고 있다.

컨테이너 장애 발생 시 자동으로 복구되는 기능을 가지고 있어서, 어플리케이션 실행에 필요한 수 만큼의 컨테이너를 항상 확보할 수 있다.

Amazon EC2의 부하분산 기능인 Elastic Load Balancing(ELB)를 사용해 트래픽을 컨테이너 전체로 분산시킬 수 있다.

어플리케이션 전개는, 이미지를 새로운 버전으로 업로드하면 구 버전 컨테이너를 정지하고 새로운 컨테이너를 자동 시작하는 방식으로 이루어진다.

AWS의 감시 서비스인 Amazon CloudWatch와 연계해, CPU나 메모리 사용을 감시할 수 있다.

#### Azure Container Service (AKS)

MS Azure의 컨테이너 매니지드 서비스로, 컨테이너 오케스트레이션 툴로 Kubernetes를 지원하고 있다.

Azure 가상 머신을 사용해 클러스터를 구성한다.

Docker 레지스트리 서비스로 Azure Container Registry를 제공한다.

Azure Batch Shipyard라는 **과학기술계산** 등의 용도로 이용되는, 대규모 분산 배치 처리 기반의 일부로도 Docker를 이용한다.

#### Google Kubernetes Engine (GKE)

GCP의 컨테이너 매니지드 서비스이다.

> #### 과학기술계산을 위한 분산 배치 처리 실행 서비스 Amazon Batch
> 
> AWS는 풀매니지드형 **분산 배치 처리 실행 서비스**인 Amazon Batch를 제공한다.
> 
> 이는 대규모 구조 해석, 유체 해석 같이 지금껏 슈퍼컴퓨터로 수행하던 과학기술계산을 **클라우드 상 리소스를 사용해** 수행하기 위한 서비스이다.
> 
> 대량의 배치 잡을 실행하기 위해 클러스터 관리 기능, 잡 스케줄러 등 기능을 보유하고 있고, 기본적으로 Amazon ECS이므로 잡이 **컨테이너 상에서 실행**되는 것이 큰 특징이다.

### Google Cloud Platform의 컨테이너 관련 서비스




