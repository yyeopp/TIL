# Chapter 06: 전송 계층 - 신뢰할 수 있는 데이터 전송하기

---

## 전송 계층의 역할

### 전송 계층의 두 가지 역할

라우터가 **라우팅** 기능을 통해 다른 네트워크로 데이터를 전송할 수 있지만, 라우팅 정보가 잘못 됐거나 패킷이 손상되는 등의 문제가 생길 가능성을 배제할 수 없다.

- 물리 계층, 데이터 링크 계층, 네트워크 계층만 있어도 **데이터 보내기** 자체는 가능하지만, **데이터 손상이나 유실**에 대해서는 달리 대책이 없는 것.

**전송 계층**은, **목적지에 신뢰할 수 있는 데이터를 전달하기 위해** 필요한 계층에 해당한다.

- 전송 계층은, **오류를 점검하는 기능**이 있어 오류 발생 시 **데이터 재전송을 요청**한다.

- 전송된 데이터의 **목적지가 어떤 어플리케이션인지 식별**하는 기능도 있다.

### 연결형 통신과 비연결형 통신

전송 계층의 특징은 **신뢰성/정확성**과 **효율성**으로 구분할 수 있다.

- **신뢰성/정확성**은, 데이터를 목적지에 **문제없이 전달**하는 것이고

- **효율성**은, 데이터를 **빠르고 효율적으로 전달**하는 것이다.

신뢰할 수 있고 정확한 데이터를 전달하는 통신을 **연결형 통신**, 효율적으로 데이터를 전달하는 통신을 **비연결형 통신**이라 한다.

- 연결형 통신이 구현되기 위해서는 데이터 송수신에 대해 **상대방과 여러 차례 확인을 거쳐가면서** 통신이 이루어져야 한다. 즉, 정확하지만 다소 느릴 수 있다.

- 비연결형 통신에서는 **상대편의 확인 없이** **일방적으로 데이터를 전송**하고 끝난다. 즉, 빠르지만 다소 부정확할 수 있다.

양자는 필요에 따라 **선택적으로 활용**할 필요가 있다.

- 동영상 스트리밍이라면 부정확하더라도 빠른 전송이 필요하기 때문에, 비연결형 통신이 적합하다.

- 전송 계층에서, **연결형 통신 프로토콜**은 **TCP**이고 **비연결형 통신 프로토콜**은 **UDP**이다.

---

## TCP의 구조

> 전송 계층에서 신뢰할 수 있는 정확한 통신을 제공하는 TCP 프로토콜의 구조에 대하여

### TCP란?

전송 계층에서 TCP로 전송하기 위해, 네트워크 계층으로 넘기기 전 붙이는 **헤더**를 **TCP 헤더**라고 한다.

- IP 헤더와 마찬가지로, TCP 헤더도 상당히 많은 정보를 담고 있다.

- 출발지 포트 번호(16비트), 목적지 포트 번호(16비트), 일련번호(32비트), 확인 응답 번호(32비트), 헤더 길이(4비트), 예약 영역(6비트), **코드 비트**(6비트), 윈도우 크기(16비트), 체크섬(16비트), 긴급 포인터(16비트), 옵션

헤더가 붙은 데이터는 **세그먼트**라고 한다.

연결형 통신을 구현하기 위해서는 상대방을 확인한 후 데이터를 전송해야 하는데, 데이터 전송에 앞서 **연결**(connection)이라는 **가상의 독점 통신로**를 확보해야 한다.

TCP 헤더의 **코드 비트** 부분이, 이러한 **연결**의 **제어 정보**가 기록되는 공간이다.

- 코드 비트는 URG, **ACK**, PSH, RST, **SYN**, FIN의 이름을 가진 6개의 비트로 구성된다.

- 각 비트별로 역할이 있고, 초깃값은 0이며, 활성화되면 1이다.

- 일단 **SYN**이 **연결 요청**, ACK가 **확인 응답**을 뜻한다는 정도를 기억해야 한다.

### 3-way 핸드셰이크란?

연결은, SYN과 ACK를 사용하여 확립할 수 있다.

신뢰할 수 있는 연결을 만들기 위해, 본격적으로 데이터를 전송하기 전에 **패킷을 3번 교환하는 절차**를 거치게 된다. 이를 3-way 핸드셰이크라고 한다.

- 송신 측에서 **연결 확립 요청**으로 **SYN**에 1을 찍은 패킷을 보낸다.

- 정상적으로 수신됐다면, 수신 측에서 **연결 확립 응답**과 **연결 확립 요청**의 의미로 **ACK**와 **SYN**에 1을 찍은 패킷을 보낸다.

- 정상적으로 도달했다면, 송신 측에서 **연결 확립 응답**으로 **ACK**에 1을 찍은 패킷을 보낸다.

데이터 전송 이후, **연결을 끊을 때도** 요청을 교환해야 한다.

연결 종료 시에는 **FIN** 과 **ACK**를 사용한다.

- 
