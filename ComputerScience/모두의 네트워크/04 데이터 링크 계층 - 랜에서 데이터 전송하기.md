# Chapter 04: 데이터 링크 계층 - 랜에서 데이터 전송하기

---

## 데이터 링크 계층의 역할과 이더넷

> 랜에서 데이터를 주고받는 규칙인 이더넷.

### 이더넷이란?

데이터 링크 계층은, **네트워크 장비 간에 신호를 주고받는 규칙을 정하는** 계층이다.

그러한 규칙들 중 일반적으로 적용되는 것이 **이더넷**(Ethernet)

- 이더넷은 **허브**와 같은 장비에 연결된 컴퓨터와 데이터를 주고받을 때 사용되는 규칙이다.

- 허브는 수신된 데이터를 포트에 연결된 다른 모든 컴퓨터에 전달하는 특성을 가지는데, 송신할 데이터에 **목적지** 정보를 추가해서 보내면 목적지 이외의 컴퓨터는 데이터를 받더라도 **무시**하는 규칙이 적용된다.

- 컴퓨터 여러 대가 허브로 동시에 데이터를 보내면 데이터들 간 **충돌**이 발생할 가능성도 있는데, 이더넷은 데이터를 동시에 전송하더라도 충돌이 일어나지 않는 구조를 만들 수 있다.
  
  - 구체적으로는 **CSMA/CD**라는 방법을 적용하여, 데이터를 **보내는 시점을 늦춤으로써** 데이터가 동시에 케이블로 지나가지 않도록 할 수 있다.
    
    - **CS**는 데이터를 보내려고 하는 컴퓨터가 **케이블에 신호가 흐르고 있는지 여부를 확인**하는 규칙이고,
    
    - **MA**는 케이블에 데이터가 **흐르지 않는 경우 데이터를 보낼 수 있다**는 규칙이고,
    
    - **CD**는 **충돌이 발생하고 있는지 여부를 확인**한다는 규칙.
  
  - 사실 현재는 효율 문제로 CSMA/CD를 거의 사용하고 있지 않다.
  
  - 대신 **스위치**라는 네트워크 장비를 사용하여 충돌을 방지하고 있다.

---

## MAC 주소의 구조

> 랜 카드를 제조할 때 정해지는 물리적인 주소

### MAC 주소란?

**랜 카드**는 비트열을 전기 신호로 변환하는 장비.

이러한 랜 카드는 **MAC 주소**라고  하는 번호가 부여된 상태로 제조된다.

- 이 때 부여되는 번호는 **전 세계를 통틀어 유일**하다.

- 총 **48비트의 숫자**로 구성되어 있는 MAC 주소는,
  
  - 앞 24비트가 랜 카드를 만드는 제조사 번호이고
  
  - 뒤 24비트가 제조사에서 붙인 랜 카드 일련번호이다.

OSI 모델 상 데이터 링크 계층에서는 데이터를 송신할 때 **이더넷 헤더**와 **트레일러**를 붙이게 되어 있다.

- 이더넷 헤더는, **목적지의 MAC 주소**(6바이트), **출발지의 MAC 주소**(6바이트), **유형**(2바이트)으로 구성된다.
  
  - **유형**이란 이더넷으로 전송이 이루어지는 **상위 계층의 프로토콜 종류를 식별할 수 있는 번호**를 써놓는 것.
    
    - IPv4면 0800, IPv6면 86DD 이런 식으로 16진수의 번호가 들어간다.

- 트레일러는 **FCS**(Frame Check Sequence)라고 하는데, 데이터 전송 도중 **오류가 발생하는지 여부를 확인**하는 용도로 사용된다.

데이터 링크 계층을 거치면서 이더넷 헤더와 트레일러가 정상적으로 추가되어 **캡슐화된** 데이터를, **프레임**이라고 한다.

- 결과적으로 네트워크를 통해 **전기 신호로 변환된 프레임 비트열이 전송**되는 것.

하나의 **허브**를 통해 컴퓨터 간 데이터 송수신이 일어나는 상황을 가정할 때,

- 송신 측에서 이더넷 헤더에 목적지의 MAC 주소를 넣어서 포트에 넣으면 허브를 통해 연결된 **모든 컴퓨터**에게 전송된다.

- 각 컴퓨터는 이더넷 헤더에 적힌 목적지 MAC 주소를 확인하고, 자신의 MAC 주소와 다르면 **데이터를 파기**하는 식으로 무시한다.

- 의도한 목적지의 컴퓨터라면, 비로소 **역캡슐화**를 통해 데이터를 수신한다.

만약 동일 목적지로 둘 이상의 데이터가 데이터를 송신하는 상황이였다면, **충돌 방지**를 위해 **CSMA/CD 방식**이 사용되었을 것이다.

---

## 스위치의 구조

> 스위치는 허브와 달리 데이터의 충돌이 발생하지 않는다.

### MAC 주소 테이블이란?

스위치는 **데이터 링크 계층**에서 동작하고, 레이어 2 스위치(**L2 스위치**) 또는 **스위칭 허브**라고도 불린다.

스위치의 내부에는, **MAC 주소 테이블**이라는 것이 존재하고 있다.

- 이는 **스위치의 포트 번호**와 해당 포트에 연결된 **컴퓨터의 MAC 주소**가 매핑되어 등록된 일종의 **데이터베이스**에 해당한다.

- 스위치에 연결된 컴퓨터에서 **프레임**이 전송되면, 
  
  - 스위치는 이더넷 헤더에 달린 **출발지 MAC 주소가 테이블에 있는지 확인하고**
  
  - 등록되어 있지 않은 MAC 주소라면 포트 번호와 함께 MAC 주소 테이블에 등록한다.
  
  - 이를 **MAC 주소 학습 기능**이라고 한다. 더미 허브는 이런 기능이 없다.

- 이러한 MAC 주소 학습의 목적은, 만약 **목적지 MAC 주소도 포트 번호와 함께 테이블에 등록**되어 있다면 **해당 포트로만 데이터를 보내는 게 가능**해지기 때문

- 스위치 가동 초기에 목적지 MAC 주소가 등록되어 있지 않은 시점이라면, **기존 허브처럼 모든 포트에 데이터를 전송**할 수밖에 없다.
  
  - 이러한 데이터 전송을 **플러딩**(flooding)이라고 한다.

MAC 주소를 기준으로 목적지 포트를 선택할 수 있는 스위치의 기능을, **MAC 주소 필터링**이라고 한다.

---

## 데이터가 케이블에서 충돌하지 않는 구조

> 케이블에 데이터가 아무리 많이 전송되어도, 데이터가 충돌하지 않는 구조가 있다.

### 전이중 통신과 반이중 통신

**전이중 통신**은 데이터의 송수신을 **동시에** 통신하는 방식이다.

- 송신용과 수신용 케이블이 분리되어 있어야 가능하다.

**반이중 통신**은 회선 하나로 **송신과 수신을 번갈아가며** 통신하는 방식이다.

- 송신용과 수신용 케이블이 분리되어 있지 않을 때 사용해야 한다.

컴퓨터 두 개가 직접 **크로스 케이블**로 연결된 경우, **전이중 통신**이 가능하다. 데이터를 동시에 전송해도 충돌할 일 자체가 없다.

반면 **더비 허브**를 이용해 컴퓨터끼리 연결해두면, 송수신에 **회선 하나만이 사용**되기 때문에 **반이중 통신**이 강제된다. 데이터 충돌 가능성도 배제할 수 없다.

**스위치**의 경우, 컴퓨터와 스위치, 스위치 내부 모두 **송수신 케이블이 분리**되어 있기 때문에 **전이중 통신** 방식을 적용할 수 있다.

- 허브 사용 시 충돌 및 그 방지로 인한 네트워크 지연이 심각하므로, 최근 네트워크에서는 스위치 사용이 표준이라고 보면 된다.

### 충돌 도메인이란?

허브는 반이중 통신이 일어나므로, 데이터 전송 시 충돌이 일어난다.

그리고 데이터 충돌이 발생할 때 **그 영향이 미치는 범위**를 **충돌 도메인**(collision domain)이라고 한다.

- 더미 허브라면, **연결되어 있는 컴퓨터 전체**가 *하나의* 충돌 도메인이 된다.

- 스위치는 전이중 통신이 일어나므로, 충돌 자체가 일어나지 않으나 충돌 도메인을 따지자면 **개별 컴퓨터**로 범위가 좁혀진다.

충돌 도메인이 넓을수록 **네트워크 지연**도 증가한다고 보면 된다.

즉, 효율적인 통신을 위해 **충돌 도메인의 범위 감소**가 중요하고, 이를 위해서라도 허브보다 스위치를 사용하는 게 좋다.

> ### ARP
> 
> ARP(Address Resolution Protocol)은 
> 
> 목적지 컴퓨터의 IP 주소를 이용해, **MAC 주소**를 찾기 위한 프로토콜
> 
> - 이더넷 프레임 전송을 위해서는 **목적지 컴퓨터의 MAC 주소가 필요**하기 때문에, 출발지 컴퓨터에서 해당 정보가 없는 경우 사용한다.
> 
> 출발지 컴퓨터는 목적지의 IP주소를 네트워크에 **브로드캐스트**로 날리는데, 이를 **ARP request**라고 한다.
> 
> - 이에 대해 지정된 IP 주소를 가진 컴퓨터는 자신의 MAC 주소를 응답으로 보내는데, 이를 **ARP reply**라고 한다.
> 
> - MAC 주소를 얻은 출발지 컴퓨터는 이를 IP 주소와 매핑하여 자신의 메모리에 보관하는데, 이를 **ARP 테이블**이라 한다. 이후에는 해당 테이블을 참고하여 네트워크를 이용하게 된다.
> 
> 하지만 IP 주소와 MAC 주소는 변경 가능하기 때문에, 이에 대비하여 ARP 테이블에서는 **보존 기간**을 **ARP 캐시**로 지정하고 일정 시간이 지나면 정보를 삭제 및 **다시 ARP 요청**을 보낸다.

---

## 이더넷의 종류와 특징

> 이더넷의 종류와 규격, 이름의 뜻

### 이더넷 규격

이더넷은 **케이블 종류**나 **통신 속도**에 따라, 다양한 **규격**으로 분류된다.

- 10BASE5, 10BASE-T 등등 많다.

**10BASE-T**를 대표로 규격 이름을 살펴보면,

- 10은 Mbps 단위의 **통신 속도**를 나타낸다.

- BASE는 **BASEBAND**라는 **전송 방식**을 나타낸다.

- T는 **케이블 종류**를 나타낸다. UTP 케이블에 해당한다.
  
  - 동축 케이블을 사용하는 경우 하이픈 없이 최대 길이를 100미터 단위 숫자만 표시한다.
  
  - 10BASE5는 최대 길이 500미터의 동축 케이블.

최근 컴퓨터의 랜 포트는 1000BASE-T가 일반적이다.
