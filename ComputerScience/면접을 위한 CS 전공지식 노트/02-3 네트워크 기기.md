# Chapter 2: 네트워크

---

# Section 3: 네트워크 기기

네트워크는 여러 개의 네트워크 기기를 기반으로 구축된다.

---

## 네트워크 기기의 처리 범위

기본적으로 **계층별로** 처리 범위를 나눌 수 있다.

이 때 상위 계층을 처리하는 기기는 그 밑 모든 계층의 프로토콜을 처리할 수 있지만, 반대는 불가하다는 특성이 발생한다.

---

## 어플리케이션 계층을 처리하는 기기

### L7 스위치

**스위치**는 여러 장비를 연결하고 데이터 통신을 중재하며, **목적지가 연결된 포트로만 전기 신호를 보내 데이터를 전송**하도록 하는 통신 네트워크 장비이다.

L7 스위치의 경우 **로드밸런서**라고 하여, **서버의 부하를 분산**하는 기기이다.

- 클라이언트로부터 오는 요청들을 여러 서버로 분산시켜주는 역할을 하여, 시스템이 처리할 수 있는 **트래픽을 증가**시켜준다.

- 트래픽 분산은 **URL, 서버, 캐시, 쿠키**들을 기반으로 이루어진다.

- 그 외에도 바이러스, 불필요한 외부 데이터 등을 걸러내는 **필터링** 기능 또한 있고, 응용 프로그램 수준의 **트래픽 모니터링**도 가능하다.

- 장애가 발생한 서버에 대해서는 트래픽 분산 대상에서 **제외**하는데, 정기적으로 이루어지는 **헬스 체크**(health check)를 통해 구현한다.

#### L4 스위치와 L7 스위치의 차이

L4 스위치 또한 로드밸런서다. 하지만,

- L4 스위치는 **인터넷 계층**을 처리한다.
  
  - 스트리밍 관련 서비스에서는 사용할 수 없다.

- 어플리케이션 계층에서 사용하는 **PDU**인 **메시지**를 기반으로 인식할 수 없기 때문에, **IP와 포트**를 기반으로 트래픽을 분산한다.

> ##### 클라우드 서비스의 경우
> 
> L7 스위치를 통한 로드밸런싱은 ALB 컴포넌트로,
> 
> L4 스위치를 통한 로드밸런싱은 NLB 컴포넌트로 한다.

#### 헬스 체크

L4와 L7 모두 주기적인 헬스 체크를 통해 **서버의 정상 여부를 판단**한다.

**전송 주기와 재전송 회수** 등을 설정한 후, **반복적으로 서버에 요청을 보내는 작업**을 통해 확인하게 된다.

- 서버 부하가 지나치지 않을 만큼 적절한 요청 회수를 설정할 필요가 있다.

- TCP, HTTP 등 다양한 방법으로 요청을 보낸다.

#### 로드밸런서를 이용한 서버 이중화

로드밸런서의 대표적인 기능으로, **서버 이중화**가 있다.

서비스를 안정적으로 운용하기 위해, 에러 발생 시를 대비하여 2대 이상의 서버를 운용하는 방식.

**가상 IP**를 제공하여 이를 기반으로 서비스를 운영한다.

- 사용자들이 사용하는 가상 IP인 0.0.12010이 있다면,

- 로드밸런서가 이를 받아서 실제 서버인 0.0.12011 또는 0.0.12012로 연결시켜주는 것.
  
  - 헬스체크 결과 둘 중 하나에 장애가 발생했다면, 그 쪽으로는 보내지 않을 수 있다.

---

## 인터넷 계층을 처리하는 기기

### 라우터(router)

라우터는, 여러 개의 네트워크를 연결, 분할, 구분시켜주는 역할을 한다.

**라우팅**은 다른 네트워크에 존재하는 장치들끼리 서로 데이터를 주고받을 때, **패킷 소모를 최소화**하고 **경로를 최적화**하여 **최소 경로로 패킷을 포워딩**하는 것인데, 이를 수행하는 장비가 라우터다.

>  

### L3 스위치

L2 스위치의 기능과 라우팅 기능을 갖춘 장비다.

즉, L3 스위치는 라우터를 포함하고 있기 때문에, 라우터라고 불러도 무방하다.

- 단, **하드웨어 기반의** 라우팅을 담당하는 장치에 해당한다.

---

## 데이터 링크 계층을 처리하는 기기

### L2 스위치

장치들의 **MAC 주소**를 **MAC 주소 테이블**을 통해 관리하며, 연결된 장치로부터 **패킷**이 왔을 때 **패킷 전송**을 담당한다.

IP 주소는 이해하지 못하므로 IP 주소를 기반으로 한 라우팅은 **불가**하며, 단순히 패킷의 **MAC 주소**를 읽어 스위칭하는 역할을 한다.

#### L3 스위치와의 비교

- L2 스위치는 **MAC 주소 테이블**을 참조하고, L3 스위치는 **라우팅 테이블**을 참조한다.

- L2 스위치는 **이더넷 프레임**을 PDU로 사용하고, L3 스위치는 **IP 패킷**을 PDU로 사용한다.

- L2 스위치는 **MAC 주소**를 참조하고, L3 스위치는 **IP 주소**를 참조한다.

### 브리지(bridge)

두 개의 근거리 통신망(**LAN**)을 **상호 접속**할 수 있도록 하는 통신망 연결 장치다.

포트와 포트 사이 다리 역할을 하며, 장치에서 받아온 **MAC 주소**를 **MAC 주소 테이블**로 관리한다.

- 서로 다른 LAN으로 이루어진 통신망들을 확장하여 **하나의** 통신망으로 구축할 때 사용된다.

---

## 물리 계층을 처리하는 기기

### NIC(Network Interface Card)

**LAN 카드**라고도 한다. 2대 이상의 컴퓨터 **네트워크**를 구성하는 데 사용하고, 네트워크와 빠른 속도로 **데이터를 송수신**할 수 있도록 **컴퓨터 내에 설치하는** 확장 카드다.

- 각각의 NIC에는 고유 식별번호인 **MAC 주소**가 담겨 있다.

- 이걸 기반으로 네트워크에 접근하는 것.

### 리피터(repeater)

접수된 신호가 약할 때, 이를 증폭하여 다른 쪽으로 전달하는 장치

패킷이 **더 멀리** 갈 수 있도록 돕는다.

- 하지만 광케이블 보급 이후 사용이 뜸해졌다.

### AP(Access Point)

**패킷을 복사**하는 기기이다.

흔히 보는 **와이파이 공유기**가 AP이다.

AP에 유선 LAN을 연결한 후, 다른 장치에서 무선 LAN 기술(**Wi-fi** 등)을 사용하여 무선 네트워크 연결을 할 수 있다.
