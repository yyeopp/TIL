# Chapter 4: 데이터베이스

---

# Section 2: ERD와 정규화 과정

**ERD**(Entity Relationship Diagram)는, DB를 구축할 때 가장 기초적인 뼈대 역할을 하는 것으로 **릴레이션 간의 관계들을 정의한 것**이다.

- 서비스 구축 시 가장 먼저 신경 써야 할 부분이다.

---

## ERD의 중요성

ERD는 **시스템의 요구 사항**을 기반으로 작성되고, 이러한 **ERD를 기반으로** 데이터베이스가 구축된다.

DB 구축 이후에도 디버깅이나 비즈니스 프로세스 재설계가 필요할 때 설계도 역할을 담당하기도 한다.

### 장단점

**관계형 구조**로 표현할 수 있는 데이터를 구성하는 데에는 매우 유용하지만,

**비정형 데이터**를 충분히 표현할 수 없다는 단점이 있다.

> #### 비정형 데이터
> 
> 비구조화 데이터. 미리 정의된 데이터 **모델**이 없거나, 미리 정의된 방식으로 정리되지 않은 정보.

---

## 정규화 과정

정규화 과정은 릴레이션 간 **잘못된 종속 관계**로 인해 **DB 이상 현상**이 일어나서 이를 해결하거나, **저장 공간을 효율적으로 사용**하기 위해 **릴레이션을 여러 개로 분리하는** 과정이다.

> #### DB 이상현상
> 
> 테이블 내의 데이터들이 불필요하게 중복되어, 테이블을 조작할 때 발생하는 데이터 불일치 현상을 총칭한다.
> 
> 잘못된 설계가 원인으로, 삽입, 삭제, 갱신 시 오류를 유발한다. 정규화를 통해 이상현상들을 해결할 수 있다.
> 
> - 삽입 이상: **원하지 않는 자료**의 삽입, key가 없어 삽입하지 못해 **불필요한 데이터를 추가**해야 삽입이 가능한 상황 등
> 
> - 삭제 이상: 하나의 자료만 삭제하고 싶어도, 그 자료가 포함된 튜플 전체가 삭제됨으로 인해 **원하지 않는 정보 손실이 발생하는** 문제
> 
> - 갱신 이상: 일부만 변경하는 과정에서 **데이터가 불일치**하는 모순, **중복 튜플이 존재하게 되는** 문제.

정규화 과정은 **정규형 원칙**을 기반으로 **정규형**을 만들어가는 과정이다.

**정규화된 정도**는, 정규형(NF, Normal Form)으로 표현할 수 있다.

- 기본 정규형으로는 제1정규형, 제2정규형, 제3정규형, 보이스/코드 정규형이 있고

- 고급 정규형으로는 제4정규형, 제5정규형이 있다.

### 정규형 원칙

- 데이터의 **중복을 최소화**함

- 정보가 사라지지 않아야 함 (**정보의 무손실**)

- 같은 의미의 정보를 유지하면서도, **더 바람직한 구조**로 변환해야 함

- 독립적인 관계는 **별개의 릴레이션**으로 표현

- 릴레이션 각각에 대해 **독립적인 조작**이 가능해야 함.

### 정규화의 효과

- 데이터 중복 배제로 데이터 관리 편의성 제고 및 자료 저장 공간 최소화

- 데이터 모형 단순화

- 데이터 구조의 안정성 및 무결성 유지

- 속성의 배열상태에 대한 검증 수단

- 엔터티와 속성의 누락 여부 검증 수단

- 자료검색과 추출의 효율성

### 제1정규형

릴레이션의 **모든 도메인이** 더 이상 분해될 수 없는 **원자 값**(atomic value)으로만 구성되어 있을 때 제1정규형을 만족한다.

한 개의 레코드의 속성들 중, 두 개 이상의 값을 가지는 반복 집합이 있을 시 이를 제거하는 것이 원칙이다.

- 학생 1인이 2개 이상의 과목을 수강한다면, 레코드를 2개 이상 만들어야 할 것

- 하나의 레코드 속 *과목* 속성에 2개 이상의 과목을 배열로 넣는 것은 지양

### 제2정규형

릴레이션이 제1정규형을 만족하면서도, **부분 함수의 종속성을 제거한 형태**를 말한다.

이는, **PK가 아닌 모든 속성이 PK에 완전 함수 종속적**인 것을 말한다.

> #### 함수적 종속
> 
> 데이터들이 어떤 기준값에 의해 종속되는 것을 의미한다.
> 
> - 하나의 *학번*에는 **항상** 같은 *이름*이 대응된다. 이 때 *이름*은 *학번*에 함수 종속적이다.
> 
> #### 완전 함수적 종속
> 
> 어떤 릴레이션 R 내의 속성 A가, R 내의 다른 속성 집합 B **전체**에 대해 **함수적 종속**이지만, 속성 집합의 B의 어떠한 **진 부분집합** C에 대해는 함수적 종속이 **아닐 때** 속성 A를 속성 집합 B에 완전 함수적 종속이라고 한다.
> 
> - 릴레이션 내에 학번, 과목명, 성적, 학년이 존재하고 (학번, 과목명)이 PK일 때,
> 
> - *성적*은 학번과 과목명이 모두 같을 때 항상 같은 성적이 나오고,
> 
> - 학번만 같거나 과목명만 같으면 같은 성적이 나올 수 없다.
> 
> - 즉, 성적은 해당 테이블의 PK에 대해 완전 함수적 종속이다.
> 
> #### 부분 함수적 종속
> 
> 어떤 릴레이션 R 내의 속성 A가 다른 속성 집합 B 전체에 대해 함수적 종속이면서, 속성 집합 B의 어떠한 **진 부분집합에 대해** **함수적 종속**일 때, 속성 A를 속성 집합 B에 부분 함수적 종속이라고 한다.
> 
> - 릴레이션 내에 학번, 과목명, 성적, 학년이 존재하고 (학번, 과목명)이 PK일 때,
> 
> - *학년*은 PK의 일부인 학번에 함수적 종속이다.
> 
> - 즉, *학년*은 해당 테이블의 PK에 대해 부분 함수적 종속이다.
> 
> #### 이행적 함수 종속
> 
> 어떤 릴레이션 R 내의 속성 A, B, C가 A->B, B->C 종속 관계에 있을 때, A->C까지 성립하는 경우 C가 A에 이행적 함수 종속을 만족시킨다고 말할 수 있다.
> 
> - 릴레이션 내에 유저ID, 유저 등급, 할인율이 존재할 때
> 
> - *유저 등급*은 *유저 ID*에 함수적 종속이고
> 
> - *할인율*은 *유저 등급*에 함수적 종속이며
> 
> - *할인율*은 결국 *유저 ID*에 함수적 종속이다.
> 
> - 이런 경우 릴레이션 R을 2개의 릴레이션으로 쪼개는 것이 타당하다.

즉, 제2정규형을 만족시키기 위해서는 **테이블을 잘 쪼개서** PK를 제외한 모든 속성이 PK에 대해 완전 함수적 종속을 충족시키도록 만들어야 한다.

- 분해 시 정보 손실이 없도록 **무손실 분해**로 유지해야 한다는 것이 중요하다.

### 제3정규형

제2정규형이면서, PK가 아닌 모든 속성이 **이행적 함수 종속**을 만족하지 **않는** 상태를 말한다.

### 보이스/코드 정규형

제3정규형이면서, 결정자가 후보키가 아닌 함수 종속 관계를 제거하여, 릴레이션의 함수 종속 관계에서 **모든 결정자가 후보키인 상태**를 말한다.

> #### 결정자
> 
> 함수 종속 관계에서 **특정 종속자**를 결정짓는 요소.
> 
> - 함수적 종속 관계 X->Y가 있으면 X가 결정자, Y가 종속자

### 반정규화

정규화를 통해 테이블을 나눈다고 해서 성능이 항상 좋아지는 것은 아니고, 오히려 나빠질 수 있다. join 쿼리가 늘어나기 때문.

**반정규화**는, **시스템의 성능 향상**을 위해 정규화된 데이터 모델을 **통합**하는 작업이다. 즉, **의도적으로 정규형 원칙을 위배하는 행위**에 해당한다.

테이블이 단순해지고 관리 효율성이 증가하지만, 데이터 일관성이나 무결성이 보장되지 않을 수 있다.

- 의도적으로 중복을 생성하게 되어 **검색 기능이 향상**되지만, **갱신, 삭제 성능**은 낮아진다.

즉, **데이터 중복 방지 및 무결성** vs **데이터베이스 성능 상승, 단순화** 사이에서 *서비스의 요구사항에 따라* 우선순위를 잘 조절해 정규화와 반정규화를 수행해야 한다.

#### 반정규화의 대상

- **수행 속도**가 지나치게 느린 경우

- 테이블의 **JOIN 연산**을 지나치게 사용하여, 데이터를 조회하는 것이 **기술적으로 어려운** 경우

- 테이블에 **많은 데이터**가 있고, 다량의 범위 혹은 특정 범위를 **자주** 처리해야 하는 경우
