# Chapter 01: 마이크로서비스 아키텍처의 이해

---

## 소프트웨어 아키텍처의 이해

### 소프트웨어 아키텍처란 무엇인가?

#### 소프트웨어 아키텍처의 정의

**소프트웨어 아키텍처**란, 소프트웨어를 구성하는 요소 간의 **관계**를 정의한 청사진이다.

- 소프트웨어 구성 전체를 조망하고 이해하는 데 유용하고,

- 관련 이해관계자들이 기술 구조를 논의하는 소통의 도구 역할도 한다.

#### 아키텍처의 표현

이해관계자들이 시스템을 이해하는 수준은 모두 제각각이므로, 소통을 위해서는 **모두가 이해 가능한** 언어와 수준으로 작성 및 공유되어야 한다.

- 이해관계자의 유형은 정말 다양하기 때문. 시스템 운영자, 아키텍트, 백엔드 개발자, 프론트 개발자, 품질 담당자 등

- 그래서 언어로는 **UML** 같은 표준화 모델링 언어를 이용하는 것이 바람직하다.

- 시스템 복잡도가 증가할수록, 아키텍처의 **표현**은 **설계**만큼이나 중요하다.

소프트웨어 아키텍처에서 이러한 *아키텍처의 표현* 관점을 **뷰**(view)라고 한다. 그리고 여러 관점에서 뷰를 표현하는 방법들이 있는데, 대표적으로 **4+1뷰**가 있다.

- 소프트웨어를 구성하는 **요소들의 관계 구조**는 **논리 뷰**(logic view) 형태로 표현한다.

- 소프트웨어 간 **동적인 흐름**과, 스레드, 프로세스 같은 **동시성 처리**는 **프로세스 뷰**(process view) 형태로 표현한다.

- 논리적 설계를 실제로 구현하는 측면의 소프트웨어 구성과 구조는 **구현 뷰**(implementation view) 형태로 표현한다.

- 시스템에서의 **소프트웨어 배치**는 **배치 뷰**(deployment view)를 이용해 표현한다.

- 위 4개의 중심에는 **유스케이스 뷰**(usecase view)가 있다.
  
  - **유스케이스**는 **시스템의 사용 사례**로, 결국 위의 4가지 뷰가 *사용 사례를 충족시키고 표현하기 위한* 아키텍처 관점들이다.

#### 아키텍처의 역할

건축물에 비유하면 건축물의 뼈대.

- 소스 코드들이 복잡하게 얽혀 있는 무형의 지식 집합체로서의 소프트웨어에서, 이를 구성하는 단위 프로그램들 간의 연결을 통해 전체적인 뼈대를 설계한다.

이를 통해 시스템의 성능을 좌우할 뿐만 아니라, 개발자의 수고를 덜고 정상동작이 가능하게 할 수 있다.

### 소프웨어 아키텍처 스타일

#### 스타일이란?

아키텍처의 스타일은 **특정 제약 조건에서 아키텍처의 방향과 접근 방법**이다.

- 주택, 아파트 같은 건축 스타일은 기후나 생활 방식 등의 제약 조건을 고려하여 설계한 결과다.

#### 소프트웨어 아키텍처 스타일

소프트웨어 아키텍처 스타일은, **시스템 요건을 충족시키기 위한 제약 조건**을 가진 아키텍처 측면의 접근 방법이다.

아키텍처 **패턴**과의 구분이 필요하다.

- 스타일은 상황 해결을 위한 **접근 방법**까지만 제시해주지만,

- 패턴은 **해결 방안**까지 경험적 사례를 기반으로 제시한다.

- 즉, 스타일은 **접근 방법**을 제시하고, 스타일을 결정한 후의 **구체적인 해결 전술**은 패턴이 제시해준다.

마이크로서비스 아키텍처 또한, 기존의 **모놀리스** 애플리케이션 구조의 문제점을 해결하기 위한 **접근 방법**에 해당한다.

- 무작정 마이크로서비스를 따를 것이 아니라, 각 아키텍처 스타일의 특징을 이해하고 적절히 적용하는 것이 좋은 설계의 기초이다.

### 아키텍처와 아키텍트 역할의 변화

#### 모놀리스에서 마이크로서비스로 변화

**모놀리스** 아키텍처는, 모든 업무 로직이 하나의 애플리케이션 형태로 패키징되어 서비스되고, 사용하는 데이터 또한 한 곳에서 참조하는 형태.

- 일부의 프로그램만 수정해도, 관련 없는 기능들까지 함께 빌드되어 배포가 이루어진다.

- 그리고 그 영향도 파악이나 서비스 연속성 유지를 위해 많은 비용이 소모된다.

- 즉, 코드 관리가 쉬울 수는 있어도 **변화에 대한 민첩한 대응**이 부적합하다.

모놀리스 아키텍처는 과거 클라우드나 PaaS 같은 플랫폼 서비스가 없던 시절에는 최적의 설계안이었지만, 지금은 각종 **인프라 지원 기술**들이 등장하면서 패러다임이 변화하였다.

**마이크로서비스**는, 하나의 큰 애플리케이션을 **아주 작은 애플리케이션 여러 개로 나누어 서비스**하는 사상이다.

- 비즈니스 환경의 급속한 변화, 시스템 규모 및 복잡도 증가로 인해 모놀리스 형태가 해결하기 어려운 많은 이슈들을 해결 가능하는 아키텍처 스타일이다.

- **민첩성, 유연성** 측면에서 이점을 가진다.

#### 회색지대와 아키텍트

프로젝트 수행 중 업무 영역이나 기술 측면에서, 의견 대립이 결론나지 않거나 무관심이 유지된 상태로 방치되는 영역을 **회색지대**라고 한다.

- 회색지대는 프로젝트 종반까지 끌리다가 결국 고비용을 치루게 된다.

항상 문제가 되는 부분은 **조직과 조직의 경계**이다. 

- 조직 간 소통 부재, 조직의 역할과 결과물에 대한 인식 부족, 무관심, 기술에 대한 이해 부족 등에서 경계 접합부에 **약간의 틈**만 생겨도, 회색지대가 양산될 수 있다.

- 그렇다고 조직 간 영역을 중첩시키는 것 또한 자원의 제약이 발생한다.

이 때, **기술적 측면**에서 팀 간의 틈을 메워 주는 역할을 **아키텍트 집단**이 맡을 수 있다.

- 조직 간 발생하는 기술적 이슈, 연결 이슈, 결과물 통합 등을 전담하여 프로젝트를 최종 성공으로 이끄는 역할을 맡을 수 있다.

#### 아키텍트 역할의 세분화와 변화

그게 가능하려면 아키텍트들이 프로젝트 내 모든 기술 요소를 이해하고 있어야 한다.

하지만 기술 발전 속도를 감안할 때 특정한 사람이 모든 영역에 정통하는 것은 불가하므로, **아키텍트 역할**에 대해서도 구분이 필요했다.

- 소프트웨어 아키텍트는 소프트웨어들의 구성과 구성 요소 간 관계를 정의하고, 적합한 솔루션을 정하고, 청사진을 제시한다.

- 프론트엔드 아키텍트는 화면 구현을 위한 각종 기술의 구조를 파악하고, 적절한 프레임워크로 구성한다.

- 프레임워크 아키텍트는 적용된 프레임워크의 안정적 구축을 위한 설정을 담당한다.

- 데이터 아키텍트는 데이터 기획과 설계를 맡는다.

- 테크니컬 아키텍트는 시스템 하드웨어 구성 및 설치를 담당한다.

- 인프라 아키텍트는 네트워크 설계 등을 담당한다.

다만, 최근 클라우드 플랫폼은 대부분의 정형화된 기능을 **자동화**하여 제공하고 있기 때문에 아키텍트의 역할이 어디까지인지 모호해지는 경향이 생겼다.

- **솔루션 아키텍트**라는 관점에서 설명할 수 있다.

#### 솔루션 아키텍트

과거 *차세대 프로젝트*라는 이름 하에 기업의 효율적 시스템 운영을 위한 **시스템 통합 사업**에서, 아키텍트들은 **기술적 중재자**의 역할을 했다.

하지만 최근 플랫폼 사업자들은 과거 아키텍트들이 했던 작업들을 SaaS, PaaS, IaaS 등 **자동화된 기능으로** 지원하고 있다. 심지어 서비스 내 **기능 단위**까지도 SaaS형 서비스로 제공하기 시작.

- 단 몇 분만에 원하는 서비스를 만들고, 필요한 만큼만 사용하여 비용을 지급하는 사업 구조가 비즈니스 생태계에 자리잡기 시작한 것.

- 플랫폼 기업들이 제작한 무수히 많은 솔루션들을, 필요와 상황에 맞게 잘 조합해서 제공하는 것이 더 중요해졌다.

그래서 아키텍트들 역시 기존 온프레미스 형태 **구축형** 사업보다 **기술 집약적 솔루션**을 이해하고 **조합**하는 능력이 더 중요해졌다.

- 기술 중재자라는 표현이 여전히 성립하지만, 역할을 수행하는 방법이 바뀐 것.

---

## 마이크로서비스 아키텍처

### 마이크로서비스 아키텍처의 이해

#### 마이크로서비스 아키텍처의 개념

마이크로서비스 아키텍처는, **아주 작은 단위로 동작하는 서비스가 구동되도록** 시스템 및 소프트웨어의 구성과 구성 요소 간의 관계를 정의한 아키텍처다.

- **서비스**와, 이를 실행할 수 있게 하는 여러 기술적 환경들로 구성된다고 볼 수 있다.

- 소프트웨어 아키텍처를 구성하기 위한 하나의 *스타일*인데, **마이크로서비스**로 이루어진 서비스 중심 아키텍처다.

#### 모놀리스 아키텍처와의 차이점

모놀리스 구조에서는, 하나의 애플리케이션에 데이터가 연결된 구성을 가진다.

- 크기가 클수록 변경 및 배포가 어려운 구조다.

반면 마이크로서비스 아키텍처는 **서비스와 데이터가 분할되어** 작은 서비스들이 **독립된 형태로 서비스를 제공**한다. 필요에 따라 서로 참고가 이루어진다.

- 애플리케이션 기능뿐만 아니라 데이터까지 분리하여, **격리된 독립된 다수의 서비스**로 구성된다.

모놀리스의 경우 클라이언트 요청에 대한 **처리 반응 속도**가 아주 중요하다.

- 특히 **데이터 조회**와 이를 처리하는 로직이 핵심이고, 거기에 문제가 생기면 시스템이 마비된다.

- 이에 대응하기 위해 로드 밸런싱, 2중화, 3중화, 백업 및 복구 등 아키텍처 결정 사항이 매우 많고, 리소스 투입량도 많다.

- 온프레미스 구축형 프로젝트라면 더더욱, 부하를 사전에 분석 및 예측하여 하드웨어를 스케일업할 것인지 등을 결정해야 했다.

마이크로서비스 아키텍처에서도 이러한 문제가 사라지는 것은 아니지만, 구조상 **서비스의 수평적 확장**이 쉬워 성능 이슈에 비교적 유연하게 대처할 수 있다.

- 물론 수많은 부속 서비스를 관리 제어하기 위한 **에코시스템**들의 역할이 아주 중요하고,

- 운영의 리스크를 줄이기 위해 **자동화, 시각화**가 잘 고려되어야 한다. 

### 서비스지향 아키텍처

#### 서비스지향

서비스지향 아키텍처는, 대규모 시스템에서 업무 처리 단위를 **각각의 서비스**로 반영하여, 데이터 중심이 아닌 **서비스 중심**으로 전체 시스템을 설계하는 아키텍처 스타일이다.

기업 환경에서 중복되는 프로세스나 업무들을 하나의 **서비스** 단위로 개발해두고 **호출해서 사용**하는 방식으로 개발한다.

- 서비스의 생성과 활용이 쉬워져, 환경 변화에 민첩하게 대응 가능한 아키텍처이다.

#### 서비스지향 아키텍처의 특징

##### 서비스 계약

서비스 계약은, 서비스와 **서비스 소비자**와의 계약을 뜻한다.

서비스는 **약속한 기능**을 수행해야 하고, 서비스 소비자는 서비스 사용을 위한 **계약 규칙**을 준수해야 한다.

계약은 여러 **버전**을 가지는데, 서비스에 문제가 발생하거나 서비스가 개선되는 상황에 대응하기 위해서다.

##### 서비스 가용성

서비스들의 가용성을 보장하기 위한 소프트웨어적 방법으로, **타임아웃** 기능 구현이 제안된다.

일정 시간 내에 서비스 요청에 대한 응답이 없으면 기존 요청 경로를 **차단**하고, 다른 경로로 요청을 변경하여 서비스가 정상적으로 수행되도록 한다.

이러한 방법을 **서비스 라우팅**이라 하는데, L4나 L7 같은 하드웨어 장비를 이용할 수도 있고 **서킷 브레이커** 같은 소프트웨어적 기능으로 구현할 수도 있다.

##### 보안

**서비스 간 호출**을 통한 상호 통신이 자주 발생하는데, 그 과정에서 별도의 인증/인가가 이루어지지 않는다면 자칫 보안상 문제가 발생할 수 있다.

- 권한에 대한 제어권을 서비스 자체에 넘기면 문제가 다소 해결된다.

##### 트랜잭션

분할된 서비스들에서 발생하는 트랜잭션들의 **일관성 유지**를 말한다.

일반적으로 서비스지향 아키텍처는, **성능상 문제**를 극복하기 위해 읽기 전용의 DB와 쓰기 전용의 DB를 분리 구성하고 있다.

- 쓰인 데이터를 읽으려면 데이터 이동이 필요하다는 건데, 이 부분에서 **데이터 일관성**과 **실시간 동기화**의 이슈가 발생한다.

서비스지향 아키텍처에서 데이터베이스는, 클라우드의 핵심 개념 중 하나인 **BASE 트랜잭션**을 적용하게 된다. 

- Basically Available Soft State Eventual Consistency

- 두 개의 노드가 있으면, 한 쪽에서 전달된 데이터로 인해 다른 쪽이 갱신된다는 사상이다.

- 일시적으로 불일치한 시점이 있고 일관성이 없지만, 결국에는 양 노드가 같아진다는 개념.

> 무슨 소리지 이게

##### 서비스 관리

서비스 수가 많아지만 이들 간의 관계도 적절하게 관리해야 한다.

- 부하 증가 시 서비스도 수평적으로 확장하여 과부하를 방지하고

- 특정 서비스에 오류가 발생하면 다른 서비스로 라우팅하고

- 상태를 실시간으로 관리 및 시각화하는 등.

#### SOA와 마이크로서비스 아키텍처는 무엇이 다른가
