# 백트래킹

- 대표적인 예시는 N-Queen 문제.

## 백트래킹(Backtracking)

- **퇴각검색**

- 모든 조합을 시도해서, 문제의 해를 찾는다.

- 해를 얻을 때까지 모든 가능성을 시도한다.

- 모든 가능성은 하나의 트리처럼 구성할 수 있고, 가지 중에 해결책이 있다.

- 선택이 이루어지면 새로운 선택지들의 집합이 생성된다.

- 이런 선택을 반복하다가 최종 상태에 도달한다.

- **보통 재귀 함수로 구현된다.**
  
  > 기본적으로 완전탐색이라고 볼 수 있다.

### 당첨 리프 노드 찾기

- 루트에서, 갈 수 있는 노드를 선택한다.

- 꽝 노드까지 도달하면 최근의 선택으로 되돌아와서 다시 시작한다.

- 더 이상의 선택지가 없는 경우 그 이전의 선택지로 돌아가서 다른 선택을 한다.

- 루트까지 돌아갔는데도 더 이상 선택지가 없다면, 찾는 답이 없다.
  
  **tree 자료구조에 대한 dfs 탐색이라고 볼 수 있다.**

- 루트 노드에서 리프 노드까지의 경로는 해답의 후보가 되는데, 완전탐색을 하면서 그 해답후보 중에서 해답을 찾을 수 있다.

- 그러나 이 방법을 사용하면, 해답이 될 가능성이 전혀 없는 노드의 후손 노드들도 모두 검색해야 하므로 비효율적.

### 상태공간트리 (state space tree)

- 문제 해결 과정에서의 모든 중간 과정들을 노드로 표현한 트리.

- 해를 찾기 위해서 탐색해야 하는 모든 후보군을 포함하고 있는 트리.
  
  - 재귀 호출의 횟수를 따져보는 데 이용 가능
  
  - 재귀 호출의 depth를 따지는 데에도 이용 가능

### 만약 8-Queens 문제라면?

- 퀸 8개를 크기 8*8의 체스판 안에서 서로를 공격할 수 없도록 배치하는 모든 경우를 구하는 문제.

- 만약 그냥 조합으로 푼다면?
  
  - 64C8로 풀어야 한다. 대략 44억 개의 경우의 수 발생: 지나치게 많음.
  
  > 4-Queen이였다면 16C4여서 1820개만 검사하면 된다. 근데 N이 커지면 못함.

- 4-Queen 문제로 축소하고, **같은 행에 퀸을 두지 않는 방법**으로 제한을 두어 생각하자.
  
  - **상태 공간 트리**로 표현해서 dfs 기법을 사용하면, 모든 경우의 수가 256개로 축소.
  
  - 그래도 여전히 많다 + 가망이 없는 경우의 수 탐색이 많아서 비효율적이다.

#### 백트래킹으로 푼다면?

- 모든 후보를 검사한다? *No*

- 백트래킹 기법:
  
  어떤 노드의 유망성을 점검한 후에, 유망하지 않다고 결정되면 그 노드의 부모로 되돌아가서 다음 자식 노드로 간다.
  
  - 유망: 어떤 노드를 방문하였을 때, 그 노드를 포함한 경로가 해답이 될 수 있음
  
  - 가지치기: 유망하지 않은 노드가 포함되는 경로는 더 이상 고려하지 않음.

- 알고리즘 구성
  
  1. 상태 공간 트리의 깊이 우선 검색(dfs)을 실시한다.
  
  2. 각 노드가 유망한지를 점검한다.
  
  3. 만일 그 노드가 유망하지 않으면, 그 노드의 부모 노드로 돌아가서 다른 노드로 검색을 계속한다.

```
backtrack (node v) 
    if promising(v) == false    // 유망하지 않으면 return (가지치기)
        return;
    if there is a solution at v    // 기저조건
        write the solution
    else
        for each child u of v
            backtrack(u)       // dfs
```

### 백트래킹과 완전탐색(DFS)의 차이

- 쉽게 혼동된다: 비선형 자료구조에 대해 재귀를 사용하기 때문

- 백트래킹은, 어떤 노드에서 출발하는 경로가 해결책으로 이어질 것 같지 않으면 더 이상 그 경로를 따라가지 않음으로써 시도의 횟수를 줄인다.
  
  - **Pruning**. "가지치기"

- 완전탐색이 모든 경로를 추적하는 데 비해, 백트래킹은 불필요한 경로를 조기에 차단한다.
  
  - 완전탐색을 가하기에 경우의 수가 너무나 많을 때 사용하면 좋은 것.
  
  - 예를 들어 N! 가지 경우의 수를 가진 문제에서 완전탐색을 하면, 처리가 불가능

- 백트래킹을 통해 일반적으로 경우의 수가 줄어들 수 있지만, 이 또한 최악의 경우 여전히 지수함수 시간을 요하므로 처리가 불가할 수 있다.
  
  > 4-Queen 문제: DFS하면 155 노드 탐색, 백트래킹하면 27 노드 탐색.

## 백트래킹 활용 - 부분집합의 합

### 문제1

- 유한 개의 정수로 이루어진 집합이 있을 때, 그 부분집합 중에서 그 집합의 원소를 모두 더한 값이 0이 되는 경우가 몇 번이나 있는지 알아내는 문제.

- 완전검색 기법으로 풀려면, 집합의 모든 부분집합을 생성한 후에 각 부분집합의 합을 계산해야 한다.

### 문제2

- 유한 개의 자연수로 이루어진 집합이 있을 때, 그 부분집합 중에서 그 집합의 원소를 모두 더한 값이 21이 되는 경우가 몇 번이나 있는지 알아내는 문제.

---
